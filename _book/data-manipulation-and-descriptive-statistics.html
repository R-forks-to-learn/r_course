<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Modern R for STATEC</title>
  <meta name="description" content="In this book, statisticians and economists working at STATEC will learn how use R for their needs. Importing data, computing descriptive statistics, running regressions and generating reports are some of the topics covered. No previous experience with R is needed.">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="Modern R for STATEC" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="pics/cover.png" />
  <meta property="og:description" content="In this book, statisticians and economists working at STATEC will learn how use R for their needs. Importing data, computing descriptive statistics, running regressions and generating reports are some of the topics covered. No previous experience with R is needed." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Modern R for STATEC" />
  
  <meta name="twitter:description" content="In this book, statisticians and economists working at STATEC will learn how use R for their needs. Importing data, computing descriptive statistics, running regressions and generating reports are some of the topics covered. No previous experience with R is needed." />
  <meta name="twitter:image" content="pics/cover.png" />

<meta name="author" content="Bruno Rodrigues">


<meta name="date" content="2017-10-13">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="reading-and-writing-data-with-rio.html">
<link rel="next" href="graphs.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Modern R for STATEC</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-is-r"><i class="fa fa-check"></i>What is R?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-is-rstudio"><i class="fa fa-check"></i>What is Rstudio?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-are-packages"><i class="fa fa-check"></i>What are packages?</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#the-author"><i class="fa fa-check"></i>The author</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html"><i class="fa fa-check"></i><b>1</b> Getting to know Rstudio</a><ul>
<li class="chapter" data-level="1.1" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#panes"><i class="fa fa-check"></i><b>1.1</b> Panes</a></li>
<li class="chapter" data-level="1.2" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#console"><i class="fa fa-check"></i><b>1.2</b> Console</a></li>
<li class="chapter" data-level="1.3" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#scripts"><i class="fa fa-check"></i><b>1.3</b> Scripts</a><ul>
<li class="chapter" data-level="1.3.1" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#the-help-pane"><i class="fa fa-check"></i><b>1.3.1</b> The help pane</a></li>
<li class="chapter" data-level="1.3.2" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#the-environment-pane"><i class="fa fa-check"></i><b>1.3.2</b> The Environment pane</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#options"><i class="fa fa-check"></i><b>1.4</b> Options</a></li>
<li class="chapter" data-level="1.5" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#keyboard-shortcuts"><i class="fa fa-check"></i><b>1.5</b> Keyboard shortcuts</a></li>
<li class="chapter" data-level="1.6" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#projects"><i class="fa fa-check"></i><b>1.6</b> Projects</a></li>
<li class="chapter" data-level="1.7" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#history"><i class="fa fa-check"></i><b>1.7</b> History</a></li>
<li class="chapter" data-level="1.8" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#plots"><i class="fa fa-check"></i><b>1.8</b> Plots</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>2</b> Packages</a></li>
<li class="chapter" data-level="3" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html"><i class="fa fa-check"></i><b>3</b> Data types and objects</a><ul>
<li class="chapter" data-level="3.1" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-numeric-class"><i class="fa fa-check"></i><b>3.1</b> The <code>numeric</code> class</a></li>
<li class="chapter" data-level="3.2" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-character-class"><i class="fa fa-check"></i><b>3.2</b> The <code>character</code> class</a></li>
<li class="chapter" data-level="3.3" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#vectors-and-matrices"><i class="fa fa-check"></i><b>3.3</b> Vectors and matrices</a><ul>
<li class="chapter" data-level="3.3.1" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-c-function"><i class="fa fa-check"></i><b>3.3.1</b> The <code>c()</code> function</a></li>
<li class="chapter" data-level="3.3.2" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#cbind-and-rbind"><i class="fa fa-check"></i><b>3.3.2</b> <code>cbind()</code> and <code>rbind()</code></a></li>
<li class="chapter" data-level="3.3.3" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-matrix-class"><i class="fa fa-check"></i><b>3.3.3</b> The <code>matrix</code> class</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-logical-class"><i class="fa fa-check"></i><b>3.4</b> The <code>logical</code> class</a></li>
<li class="chapter" data-level="3.5" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-list-class"><i class="fa fa-check"></i><b>3.5</b> The <code>list</code> class</a></li>
<li class="chapter" data-level="3.6" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercises"><i class="fa fa-check"></i><b>3.6</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-1"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="3.6.1" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-2"><i class="fa fa-check"></i><b>3.6.1</b> Exercise 2</a></li>
<li class="chapter" data-level="3.6.2" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-3"><i class="fa fa-check"></i><b>3.6.2</b> Exercise 3</a></li>
<li class="chapter" data-level="3.6.3" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-4"><i class="fa fa-check"></i><b>3.6.3</b> Exercise 4</a></li>
<li class="chapter" data-level="3.6.4" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-5"><i class="fa fa-check"></i><b>3.6.4</b> Exercise 5</a></li>
<li class="chapter" data-level="3.6.5" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-6"><i class="fa fa-check"></i><b>3.6.5</b> Exercise 6</a></li>
<li class="chapter" data-level="3.6.6" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-7"><i class="fa fa-check"></i><b>3.6.6</b> Exercise 7</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="reading-and-writing-data-with-rio.html"><a href="reading-and-writing-data-with-rio.html"><i class="fa fa-check"></i><b>4</b> Reading and writing data with <code>rio</code></a></li>
<li class="chapter" data-level="5" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html"><i class="fa fa-check"></i><b>5</b> Data manipulation and descriptive statistics</a><ul>
<li class="chapter" data-level="5.1" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#working-with-a-single-dataset"><i class="fa fa-check"></i><b>5.1</b> Working with a single dataset</a></li>
<li class="chapter" data-level="5.2" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#working-with-a-list-of-datasets"><i class="fa fa-check"></i><b>5.2</b> Working with a list of datasets</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="graphs.html"><a href="graphs.html"><i class="fa fa-check"></i><b>6</b> Graphs</a><ul>
<li class="chapter" data-level="6.1" data-path="graphs.html"><a href="graphs.html#ggplot2"><i class="fa fa-check"></i><b>6.1</b> ggplot2</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="statistical-models.html"><a href="statistical-models.html"><i class="fa fa-check"></i><b>7</b> Statistical models</a></li>
<li class="chapter" data-level="8" data-path="programming-with-r.html"><a href="programming-with-r.html"><i class="fa fa-check"></i><b>8</b> Programming with R</a><ul>
<li class="chapter" data-level="8.1" data-path="programming-with-r.html"><a href="programming-with-r.html#writing-your-own-functions"><i class="fa fa-check"></i><b>8.1</b> Writing your own functions</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="placeholder.html"><a href="placeholder.html"><i class="fa fa-check"></i><b>9</b> Placeholder</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Modern R for STATEC</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-manipulation-and-descriptive-statistics" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Data manipulation and descriptive statistics</h1>
<p>Now that we are familiar with some R objects and know how to import data, it is time to actually write some code. In this chapter, we are going to compute descriptive statistics for a single dataset, but also for a list of datasets. However, I will not give a list of functions to compute descriptive statistics; if you need a specific function you can find easily in the <em>Help</em> pane in Rstudio or using any modern internet searh engine. What I will do is show you a workflow that allows you to compute the statisics you need fast.</p>
<p>R has a lot of built-in functions for descriptive statistics; however, if you want to compute statistics by, say, gender, some more complex manipulations are needed. At least this was true in the past. Nowadays, thanks to the packages from the tidyverse (remember those we installed at the beginning of the book?), it is very easy and fast to compute descriptive statistics by any stratifying variable(s).</p>
<p>The package we are going to use for this is called <code>dplyr</code>. <code>dplyr</code> contains a lot of functions that make manipulating data and computing descriptive statistics very easy. To make things easier for now, we are going to use example data included with dplyr. So no need to import an external dataset; this does not change anything to the example that we are going to study here; the source of the data does not matter for this.</p>
<div id="working-with-a-single-dataset" class="section level2">
<h2><span class="header-section-number">5.1</span> Working with a single dataset</h2>
<p>First, let’s load <code>dplyr</code> and the included <code>starwars</code> dataset. Let’s also take a look at the first 5 lines of the dataset:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)

<span class="kw">data</span>(starwars)

<span class="kw">head</span>(starwars)</code></pre></div>
<pre><code>## # A tibble: 6 x 13
##             name height  mass  hair_color  skin_color eye_color birth_year
##            &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt;       &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;
## 1 Luke Skywalker    172    77       blond        fair      blue       19.0
## 2          C-3PO    167    75        &lt;NA&gt;        gold    yellow      112.0
## 3          R2-D2     96    32        &lt;NA&gt; white, blue       red       33.0
## 4    Darth Vader    202   136        none       white    yellow       41.9
## 5    Leia Organa    150    49       brown       light     brown       19.0
## 6      Owen Lars    178   120 brown, grey       light      blue       52.0
## # ... with 6 more variables: gender &lt;chr&gt;, homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p><code>data(starwars)</code> loads the example dataset called <code>starwars</code> that is included in the package <code>dplyr</code>. As I said earlier, this is just an example; you could have loaded an external dataset, from a <code>.csv</code> for instance. This does not matter for what comes next.</p>
<p>R includes a lot of function for descriptive statistics, such as <code>mean()</code>, <code>sd()</code>, <code>cov()</code>, and many more. What <code>dplyr</code> brings to the table is the possibility to apply these functions to the dataset easily. For example, imagine you want the average height of everyone in the dataset. Using the basic R functions, you could write this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(starwars<span class="op">$</span>height)</code></pre></div>
<pre><code>## [1] NA</code></pre>
<p><code>starwars$height</code> means that the user wants to access the column called <code>height</code> from the dataset <code>starwars</code>. This is then given as an argument to the function <code>mean()</code>. But what if the user wants the average height by species? Before <code>dplyr</code>, a solution to this simple problem would have required more than a single command. Now this is as easy as:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(species) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="kw">mean</span>(height))</code></pre></div>
<pre><code>## # A tibble: 38 x 2
##      species `mean(height)`
##        &lt;chr&gt;          &lt;dbl&gt;
##  1    Aleena        79.0000
##  2  Besalisk       198.0000
##  3    Cerean       198.0000
##  4  Chagrian       196.0000
##  5  Clawdite       168.0000
##  6     Droid             NA
##  7       Dug       112.0000
##  8      Ewok        88.0000
##  9 Geonosian       183.0000
## 10    Gungan       208.6667
## # ... with 28 more rows</code></pre>
<p>Ok, I know what you’re thinking. <em>What the hell is this weird <code>%&gt;%</code> thing?</em>. That weird thing is called the pipe operator. What it does is taking the left-hand side argument and piping it as the first argument of the function on the right-hand side. Try the following in the command line:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">4</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sqrt</span>()</code></pre></div>
<pre><code>## [1] 2</code></pre>
<p>It is equivalent to <code>sqrt(4)</code>. Why use that though? You will see in the next examples that using the <code>%&gt;%</code> makes writing and reading code, much, much easier. For example, the previous manipulation I did could be read as “Take the starwars data, give it to the <code>group_by()</code> function and then compute the mean height”. Without the <code>%&gt;%</code>, one would need to write:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarise</span>(<span class="kw">group_by</span>(starwars, species), <span class="kw">mean</span>(height))</code></pre></div>
<pre><code>## # A tibble: 38 x 2
##      species `mean(height)`
##        &lt;chr&gt;          &lt;dbl&gt;
##  1    Aleena        79.0000
##  2  Besalisk       198.0000
##  3    Cerean       198.0000
##  4  Chagrian       196.0000
##  5  Clawdite       168.0000
##  6     Droid             NA
##  7       Dug       112.0000
##  8      Ewok        88.0000
##  9 Geonosian       183.0000
## 10    Gungan       208.6667
## # ... with 28 more rows</code></pre>
<p>as you can see, it is much more difficult to read. Imagine now that I want average height by species, but only for males. Again, this is very easy using <code>%&gt;%</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(gender <span class="op">==</span><span class="st"> &quot;male&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(species) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="kw">mean</span>(height))</code></pre></div>
<pre><code>## # A tibble: 32 x 2
##      species `mean(height)`
##        &lt;chr&gt;          &lt;dbl&gt;
##  1    Aleena        79.0000
##  2  Besalisk       198.0000
##  3    Cerean       198.0000
##  4  Chagrian       196.0000
##  5       Dug       112.0000
##  6      Ewok        88.0000
##  7 Geonosian       183.0000
##  8    Gungan       208.6667
##  9     Human             NA
## 10  Iktotchi       188.0000
## # ... with 22 more rows</code></pre>
<p>Again, the <code>%&gt;%</code> makes the above lines of code very easy to read. Without it, one would write:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarise</span>(<span class="kw">group_by</span>(<span class="kw">filter</span>(starwars, gender <span class="op">==</span><span class="st"> &quot;male&quot;</span>), species), <span class="kw">mean</span>(height))</code></pre></div>
<pre><code>## # A tibble: 32 x 2
##      species `mean(height)`
##        &lt;chr&gt;          &lt;dbl&gt;
##  1    Aleena        79.0000
##  2  Besalisk       198.0000
##  3    Cerean       198.0000
##  4  Chagrian       196.0000
##  5       Dug       112.0000
##  6      Ewok        88.0000
##  7 Geonosian       183.0000
##  8    Gungan       208.6667
##  9     Human             NA
## 10  Iktotchi       188.0000
## # ... with 22 more rows</code></pre>
<p>I think you agree with me that this is not very readable. To make things clearer; <code>filter()</code>, <code>group_by()</code> and <code>summarise()</code> are functions that are included in <code>dplyr</code>. <code>%&gt;%</code> is actually a function from <code>magrittr</code>, but this package gets loaded when you load <code>dplyr</code> automatically, so you do not need to worry about it. <code>mean()</code> is a function <em>native</em> to R. Another thing very nice about using <code>dplyr</code>; the result of all these operations are datasets, or <code>tibbles</code>. This means that you can save them in variable, and then work with these as any other datasets.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mean_height =<span class="st"> </span>starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(species) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="kw">mean</span>(height))

<span class="kw">class</span>(mean_height)</code></pre></div>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(mean_height)</code></pre></div>
<pre><code>## # A tibble: 6 x 2
##    species `mean(height)`
##      &lt;chr&gt;          &lt;dbl&gt;
## 1   Aleena             79
## 2 Besalisk            198
## 3   Cerean            198
## 4 Chagrian            196
## 5 Clawdite            168
## 6    Droid             NA</code></pre>
<p>You could then write this data to disk using <code>rio::export()</code> for instance. If you need more than the mean of the height, you can keep adding as many functions as needed:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">summary_table =<span class="st"> </span>starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(species) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">ave_height =</span> <span class="kw">mean</span>(height), <span class="dt">var_height =</span> <span class="kw">var</span>(height), <span class="dt">n_obs =</span> <span class="kw">n</span>())

<span class="kw">print</span>(summary_table)</code></pre></div>
<pre><code>## # A tibble: 38 x 4
##      species ave_height var_height n_obs
##        &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt; &lt;int&gt;
##  1    Aleena    79.0000         NA     1
##  2  Besalisk   198.0000         NA     1
##  3    Cerean   198.0000         NA     1
##  4  Chagrian   196.0000         NA     1
##  5  Clawdite   168.0000         NA     1
##  6     Droid         NA         NA     5
##  7       Dug   112.0000         NA     1
##  8      Ewok    88.0000         NA     1
##  9 Geonosian   183.0000         NA     1
## 10    Gungan   208.6667   201.3333     3
## # ... with 28 more rows</code></pre>
<p>I did several things there; I’ve added more functions, <code>var()</code> to get the variance and <code>n()</code> (which is a function from <code>dplyr</code>, not base R) to get the number of observations. This is quite useful, because we see that for a lot of species we only have one single individual! Let’s focus on the species for which we have more than 1 individual. Since we save all the previous operations (which produce a <code>tibble</code>) in a variable, we can keep going from there:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">summary_table2 =<span class="st"> </span>summary_table <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(n_obs <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)

<span class="kw">print</span>(summary_table2)</code></pre></div>
<pre><code>## # A tibble: 9 x 4
##    species ave_height var_height n_obs
##      &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt; &lt;int&gt;
## 1    Droid         NA         NA     5
## 2   Gungan   208.6667   201.3333     3
## 3    Human         NA         NA    35
## 4 Kaminoan   221.0000   128.0000     2
## 5 Mirialan   168.0000     8.0000     2
## 6  Twi&#39;lek   179.0000     2.0000     2
## 7  Wookiee   231.0000    18.0000     2
## 8   Zabrak   173.0000     8.0000     2
## 9     &lt;NA&gt;         NA         NA     5</code></pre>
<p>There’s a lot of <code>NA</code>s; this is because by default, <code>mean()</code> and <code>var()</code> return <code>NA</code> if even one single observation is <code>NA</code> (unlike STATA). <code>mean()</code> and <code>var()</code> have a <code>na.rm</code> option that the user can set to <code>TRUE</code> to get the result by ignoring the <code>NA</code>s:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(species) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">ave_height =</span> <span class="kw">mean</span>(height, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">var_height =</span> <span class="kw">var</span>(height, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">n_obs =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(n_obs <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</code></pre></div>
<pre><code>## # A tibble: 9 x 4
##    species ave_height var_height n_obs
##      &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt; &lt;int&gt;
## 1    Droid   140.0000  2704.6667     5
## 2   Gungan   208.6667   201.3333     3
## 3    Human   176.6452   157.1699    35
## 4 Kaminoan   221.0000   128.0000     2
## 5 Mirialan   168.0000     8.0000     2
## 6  Twi&#39;lek   179.0000     2.0000     2
## 7  Wookiee   231.0000    18.0000     2
## 8   Zabrak   173.0000     8.0000     2
## 9     &lt;NA&gt;   160.0000  1826.0000     5</code></pre>
<p>In the code above, I have combined the two previous steps to get the result I’m interested in. There’s a line in the final output that says <code>NA</code> for the spcies. Let’s go back to the raw data and find this line with the function <code>which()</code> (which is a basic R function):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">na_species &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">is.na</span>(starwars<span class="op">$</span>species))

starwars[na_species, ]</code></pre></div>
<pre><code>## # A tibble: 5 x 13
##             name height  mass hair_color  skin_color eye_color birth_year
##            &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt;      &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;
## 1       Ric Olié    183    NA      brown        fair      blue         NA
## 2  Quarsh Panaka    183    NA      black        dark     brown         62
## 3         R4-P17     96    NA       none silver, red red, blue         NA
## 4      Sly Moore    178    48       none        pale     white         NA
## 5 Captain Phasma     NA    NA    unknown     unknown   unknown         NA
## # ... with 6 more variables: gender &lt;chr&gt;, homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>To test for <code>NA</code>, one uses the function <code>is.na()</code> and then <code>which()</code> returns the index where this condition is <code>TRUE</code>. So what I did above is save the row number where <code>species</code> is <code>NA</code> and then using the <code>[]</code> I slive the original raw data to get the entire line. As you can see, there’s a few of them. An alternative way of doing that, using <code>dplyr</code> would be the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">is.na</span>(species))</code></pre></div>
<pre><code>## # A tibble: 5 x 13
##             name height  mass hair_color  skin_color eye_color birth_year
##            &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt;      &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;
## 1       Ric Olié    183    NA      brown        fair      blue         NA
## 2  Quarsh Panaka    183    NA      black        dark     brown         62
## 3         R4-P17     96    NA       none silver, red red, blue         NA
## 4      Sly Moore    178    48       none        pale     white         NA
## 5 Captain Phasma     NA    NA    unknown     unknown   unknown         NA
## # ... with 6 more variables: gender &lt;chr&gt;, homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>or if you want to remove these lines:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(species))</code></pre></div>
<pre><code>## # A tibble: 82 x 13
##                  name height  mass    hair_color  skin_color eye_color
##                 &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt;         &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;
##  1     Luke Skywalker    172    77         blond        fair      blue
##  2              C-3PO    167    75          &lt;NA&gt;        gold    yellow
##  3              R2-D2     96    32          &lt;NA&gt; white, blue       red
##  4        Darth Vader    202   136          none       white    yellow
##  5        Leia Organa    150    49         brown       light     brown
##  6          Owen Lars    178   120   brown, grey       light      blue
##  7 Beru Whitesun lars    165    75         brown       light      blue
##  8              R5-D4     97    32          &lt;NA&gt;  white, red       red
##  9  Biggs Darklighter    183    84         black       light     brown
## 10     Obi-Wan Kenobi    182    77 auburn, white        fair blue-gray
## # ... with 72 more rows, and 7 more variables: birth_year &lt;dbl&gt;,
## #   gender &lt;chr&gt;, homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>The <code>!()</code> function negates a predicate function (a predicate function is a function that returns <code>TRUE</code> or <code>FALSE</code>). We can then rerun our analysis from before:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(species)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(species) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">ave_height =</span> <span class="kw">mean</span>(height, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">var_height =</span> <span class="kw">var</span>(height, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">n_obs =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(n_obs <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</code></pre></div>
<pre><code>## # A tibble: 8 x 4
##    species ave_height var_height n_obs
##      &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt; &lt;int&gt;
## 1    Droid   140.0000  2704.6667     5
## 2   Gungan   208.6667   201.3333     3
## 3    Human   176.6452   157.1699    35
## 4 Kaminoan   221.0000   128.0000     2
## 5 Mirialan   168.0000     8.0000     2
## 6  Twi&#39;lek   179.0000     2.0000     2
## 7  Wookiee   231.0000    18.0000     2
## 8   Zabrak   173.0000     8.0000     2</code></pre>
<p><code>dplyr</code> contains a lot of different functions, one of which is <code>mutate()</code>. <code>mutate()</code> allows you to create new columns. For instance, suppose you need a column of the height of the individuals in meters, and not in centimeters:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">starwars =<span class="st"> </span>starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">height_m =</span> height<span class="op">/</span><span class="dv">100</span>)

<span class="kw">glimpse</span>(starwars)</code></pre></div>
<pre><code>## Observations: 87
## Variables: 14
## $ name       &lt;chr&gt; &quot;Luke Skywalker&quot;, &quot;C-3PO&quot;, &quot;R2-D2&quot;, &quot;Darth Vader&quot;, ...
## $ height     &lt;int&gt; 172, 167, 96, 202, 150, 178, 165, 97, 183, 182, 188...
## $ mass       &lt;dbl&gt; 77.0, 75.0, 32.0, 136.0, 49.0, 120.0, 75.0, 32.0, 8...
## $ hair_color &lt;chr&gt; &quot;blond&quot;, NA, NA, &quot;none&quot;, &quot;brown&quot;, &quot;brown, grey&quot;, &quot;b...
## $ skin_color &lt;chr&gt; &quot;fair&quot;, &quot;gold&quot;, &quot;white, blue&quot;, &quot;white&quot;, &quot;light&quot;, &quot;l...
## $ eye_color  &lt;chr&gt; &quot;blue&quot;, &quot;yellow&quot;, &quot;red&quot;, &quot;yellow&quot;, &quot;brown&quot;, &quot;blue&quot;,...
## $ birth_year &lt;dbl&gt; 19.0, 112.0, 33.0, 41.9, 19.0, 52.0, 47.0, NA, 24.0...
## $ gender     &lt;chr&gt; &quot;male&quot;, NA, NA, &quot;male&quot;, &quot;female&quot;, &quot;male&quot;, &quot;female&quot;,...
## $ homeworld  &lt;chr&gt; &quot;Tatooine&quot;, &quot;Tatooine&quot;, &quot;Naboo&quot;, &quot;Tatooine&quot;, &quot;Alder...
## $ species    &lt;chr&gt; &quot;Human&quot;, &quot;Droid&quot;, &quot;Droid&quot;, &quot;Human&quot;, &quot;Human&quot;, &quot;Human...
## $ films      &lt;list&gt; [&lt;&quot;Revenge of the Sith&quot;, &quot;Return of the Jedi&quot;, &quot;Th...
## $ vehicles   &lt;list&gt; [&lt;&quot;Snowspeeder&quot;, &quot;Imperial Speeder Bike&quot;&gt;, &lt;&gt;, &lt;&gt;,...
## $ starships  &lt;list&gt; [&lt;&quot;X-wing&quot;, &quot;Imperial shuttle&quot;&gt;, &lt;&gt;, &lt;&gt;, &quot;TIE Adva...
## $ height_m   &lt;dbl&gt; 1.72, 1.67, 0.96, 2.02, 1.50, 1.78, 1.65, 0.97, 1.8...</code></pre>
<p>I have used <code>mutate()</code> to compute the column I need and <code>glimpse()</code> is an alternative to <code>print()</code> that I find very interesting. We can see the column we created at the very bottom. It might be interesting to reorder the columns; this is possible with <code>select()</code> another <code>dplyr</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">starwars =<span class="st"> </span>starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(name, height, height_m, <span class="kw">everything</span>())

<span class="kw">glimpse</span>(starwars)</code></pre></div>
<pre><code>## Observations: 87
## Variables: 14
## $ name       &lt;chr&gt; &quot;Luke Skywalker&quot;, &quot;C-3PO&quot;, &quot;R2-D2&quot;, &quot;Darth Vader&quot;, ...
## $ height     &lt;int&gt; 172, 167, 96, 202, 150, 178, 165, 97, 183, 182, 188...
## $ height_m   &lt;dbl&gt; 1.72, 1.67, 0.96, 2.02, 1.50, 1.78, 1.65, 0.97, 1.8...
## $ mass       &lt;dbl&gt; 77.0, 75.0, 32.0, 136.0, 49.0, 120.0, 75.0, 32.0, 8...
## $ hair_color &lt;chr&gt; &quot;blond&quot;, NA, NA, &quot;none&quot;, &quot;brown&quot;, &quot;brown, grey&quot;, &quot;b...
## $ skin_color &lt;chr&gt; &quot;fair&quot;, &quot;gold&quot;, &quot;white, blue&quot;, &quot;white&quot;, &quot;light&quot;, &quot;l...
## $ eye_color  &lt;chr&gt; &quot;blue&quot;, &quot;yellow&quot;, &quot;red&quot;, &quot;yellow&quot;, &quot;brown&quot;, &quot;blue&quot;,...
## $ birth_year &lt;dbl&gt; 19.0, 112.0, 33.0, 41.9, 19.0, 52.0, 47.0, NA, 24.0...
## $ gender     &lt;chr&gt; &quot;male&quot;, NA, NA, &quot;male&quot;, &quot;female&quot;, &quot;male&quot;, &quot;female&quot;,...
## $ homeworld  &lt;chr&gt; &quot;Tatooine&quot;, &quot;Tatooine&quot;, &quot;Naboo&quot;, &quot;Tatooine&quot;, &quot;Alder...
## $ species    &lt;chr&gt; &quot;Human&quot;, &quot;Droid&quot;, &quot;Droid&quot;, &quot;Human&quot;, &quot;Human&quot;, &quot;Human...
## $ films      &lt;list&gt; [&lt;&quot;Revenge of the Sith&quot;, &quot;Return of the Jedi&quot;, &quot;Th...
## $ vehicles   &lt;list&gt; [&lt;&quot;Snowspeeder&quot;, &quot;Imperial Speeder Bike&quot;&gt;, &lt;&gt;, &lt;&gt;,...
## $ starships  &lt;list&gt; [&lt;&quot;X-wing&quot;, &quot;Imperial shuttle&quot;&gt;, &lt;&gt;, &lt;&gt;, &quot;TIE Adva...</code></pre>
<p><code>select()</code> allows you to reorder columns by writing the order of the columns you want, and then you can use <code>everything()</code> (another <code>dplyr</code> function) to just tell <code>select()</code> that you want everything else in there. But <code>select()</code> also allows you to only select a subset of columns, if needed:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(name, height, height_m, gender) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">glimpse</span>()</code></pre></div>
<pre><code>## Observations: 87
## Variables: 4
## $ name     &lt;chr&gt; &quot;Luke Skywalker&quot;, &quot;C-3PO&quot;, &quot;R2-D2&quot;, &quot;Darth Vader&quot;, &quot;L...
## $ height   &lt;int&gt; 172, 167, 96, 202, 150, 178, 165, 97, 183, 182, 188, ...
## $ height_m &lt;dbl&gt; 1.72, 1.67, 0.96, 2.02, 1.50, 1.78, 1.65, 0.97, 1.83,...
## $ gender   &lt;chr&gt; &quot;male&quot;, NA, NA, &quot;male&quot;, &quot;female&quot;, &quot;male&quot;, &quot;female&quot;, N...</code></pre>
<p>The last thing I want to show you are the so-called <em>scoped</em> version of these functions. For example, what if I am only interested in columns that contains text? Is there a way to select them automatically? For this type of tasks, you can use <code>select_if()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select_if</span>(is.character)</code></pre></div>
<pre><code>## # A tibble: 87 x 7
##                  name    hair_color  skin_color eye_color gender homeworld
##                 &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;
##  1     Luke Skywalker         blond        fair      blue   male  Tatooine
##  2              C-3PO          &lt;NA&gt;        gold    yellow   &lt;NA&gt;  Tatooine
##  3              R2-D2          &lt;NA&gt; white, blue       red   &lt;NA&gt;     Naboo
##  4        Darth Vader          none       white    yellow   male  Tatooine
##  5        Leia Organa         brown       light     brown female  Alderaan
##  6          Owen Lars   brown, grey       light      blue   male  Tatooine
##  7 Beru Whitesun lars         brown       light      blue female  Tatooine
##  8              R5-D4          &lt;NA&gt;  white, red       red   &lt;NA&gt;  Tatooine
##  9  Biggs Darklighter         black       light     brown   male  Tatooine
## 10     Obi-Wan Kenobi auburn, white        fair blue-gray   male   Stewjon
## # ... with 77 more rows, and 1 more variables: species &lt;chr&gt;</code></pre>
<p><code>select_if()</code> selects every column that is of type character. There is also <code>select_all()</code> and <code>select_at()</code>, each with they’re own use. I will not go into more detail here. If you are interested, I advise you read <code>dplyr</code>’s help and also the section I wrote in my other <a href="https://b-rodrigues.github.io/fput/tidyverse.html">book</a> which goes into much more detail.</p>
</div>
<div id="working-with-a-list-of-datasets" class="section level2">
<h2><span class="header-section-number">5.2</span> Working with a list of datasets</h2>
<p>Let’s read the list of datasets from the previous chapter:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">paths =<span class="st"> </span><span class="kw">Sys.glob</span>(<span class="st">&quot;datasets/unemployment/*.csv&quot;</span>)

all_datasets =<span class="st"> </span><span class="kw">import_list</span>(paths)

<span class="kw">str</span>(all_datasets)</code></pre></div>
<pre><code>## List of 4
##  $ :&#39;data.frame&#39;:    118 obs. of  7 variables:
##   ..$ Commune                   : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ Total employed population : int [1:118] 223407 17802 1703 844 1431 4094 2146 971 1218 3002 ...
##   ..$ of which: Wage-earners    : int [1:118] 203535 15993 1535 750 1315 3800 1874 858 1029 2664 ...
##   ..$ of which: Non-wage-earners: int [1:118] 19872 1809 168 94 116 294 272 113 189 338 ...
##   ..$ Unemployed                : int [1:118] 19287 1071 114 25 74 261 98 45 66 207 ...
##   ..$ Active population         : int [1:118] 242694 18873 1817 869 1505 4355 2244 1016 1284 3209 ...
##   ..$ Unemployment rate (in %)  : num [1:118] 7.95 5.67 6.27 2.88 4.92 ...
##  $ :&#39;data.frame&#39;:    118 obs. of  7 variables:
##   ..$ Commune                   : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ Total employed population : int [1:118] 228423 18166 1767 845 1505 4129 2172 1007 1268 3124 ...
##   ..$ of which: Wage-earners    : int [1:118] 208238 16366 1606 757 1390 3840 1897 887 1082 2782 ...
##   ..$ of which: Non-wage-earners: int [1:118] 20185 1800 161 88 115 289 275 120 186 342 ...
##   ..$ Unemployed                : int [1:118] 19362 1066 122 19 66 287 91 38 61 202 ...
##   ..$ Active population         : int [1:118] 247785 19232 1889 864 1571 4416 2263 1045 1329 3326 ...
##   ..$ Unemployment rate (in %)  : num [1:118] 7.81 5.54 6.46 2.2 4.2 ...
##  $ :&#39;data.frame&#39;:    118 obs. of  7 variables:
##   ..$ Commune                   : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ Total employed population : int [1:118] 233130 18310 1780 870 1470 4130 2170 1050 1300 3140 ...
##   ..$ of which: Wage-earners    : int [1:118] 212530 16430 1620 780 1350 3820 1910 920 1100 2770 ...
##   ..$ of which: Non-wage-earners: int [1:118] 20600 1880 160 90 120 310 260 130 200 370 ...
##   ..$ Unemployed                : int [1:118] 18806 988 106 29 73 260 80 41 72 169 ...
##   ..$ Active population         : int [1:118] 251936 19298 1886 899 1543 4390 2250 1091 1372 3309 ...
##   ..$ Unemployment rate (in %)  : num [1:118] 7.46 5.12 5.62 3.23 4.73 ...
##  $ :&#39;data.frame&#39;:    118 obs. of  7 variables:
##   ..$ Commune                   : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ Total employed population : int [1:118] 236100 18380 1790 870 1470 4160 2160 1030 1330 3150 ...
##   ..$ of which: Wage-earners    : int [1:118] 215430 16500 1640 780 1350 3840 1900 900 1130 2780 ...
##   ..$ of which: Non-wage-earners: int [1:118] 20670 1880 150 90 120 320 260 130 200 370 ...
##   ..$ Unemployed                : int [1:118] 18185 975 91 27 66 246 76 35 70 206 ...
##   ..$ Active population         : int [1:118] 254285 19355 1881 897 1536 4406 2236 1065 1400 3356 ...
##   ..$ Unemployment rate (in %)  : num [1:118] 7.15 5.04 4.84 3.01 4.3 ...</code></pre>
<p>For working with lists, another package from the <code>tidyverse</code> is very useful, and that would be <code>purrr</code>. <code>purrr</code> has functions to work with lists, and we are going to focus on two of them, <code>map()</code> and <code>reduce()</code>. <code>map()</code>… maps a function to each element of a list. <code>reduce()</code> is a bit more complicated so we’ll leave that for later.</p>
<p>The first thing we are going to do is use a function to clean the names of the datasets. These names are not very easy to work with; there’s spaces, and it would be better if the names of the columns would be all lowercase. For this we are going to use the function <code>clean_names()</code> from the <code>janitor</code> package. For a sing dataset, I would write this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(janitor)

one_dataset =<span class="st"> </span>one_dataset <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">clean_names</span>()</code></pre></div>
<p>and I would get a dataset with column names in lowercase and spaces replaced by <code>_</code>. How can I apply, or map, this function to each dataset in the list? To do this I need to use <code>purrr::map()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(purrr)

all_datasets =<span class="st"> </span>all_datasets <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">map</span>(clean_names)

all_datasets <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">glimpse</span>()</code></pre></div>
<pre><code>## List of 4
##  $ :&#39;data.frame&#39;:    118 obs. of  7 variables:
##   ..$ commune                     : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ total_employed_population   : int [1:118] 223407 17802 1703 844 1431 4094 2146 971 1218 3002 ...
##   ..$ of_which_wage_earners       : int [1:118] 203535 15993 1535 750 1315 3800 1874 858 1029 2664 ...
##   ..$ of_which_non_wage_earners   : int [1:118] 19872 1809 168 94 116 294 272 113 189 338 ...
##   ..$ unemployed                  : int [1:118] 19287 1071 114 25 74 261 98 45 66 207 ...
##   ..$ active_population           : int [1:118] 242694 18873 1817 869 1505 4355 2244 1016 1284 3209 ...
##   ..$ unemployment_rate_in_percent: num [1:118] 7.95 5.67 6.27 2.88 4.92 ...
##  $ :&#39;data.frame&#39;:    118 obs. of  7 variables:
##   ..$ commune                     : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ total_employed_population   : int [1:118] 228423 18166 1767 845 1505 4129 2172 1007 1268 3124 ...
##   ..$ of_which_wage_earners       : int [1:118] 208238 16366 1606 757 1390 3840 1897 887 1082 2782 ...
##   ..$ of_which_non_wage_earners   : int [1:118] 20185 1800 161 88 115 289 275 120 186 342 ...
##   ..$ unemployed                  : int [1:118] 19362 1066 122 19 66 287 91 38 61 202 ...
##   ..$ active_population           : int [1:118] 247785 19232 1889 864 1571 4416 2263 1045 1329 3326 ...
##   ..$ unemployment_rate_in_percent: num [1:118] 7.81 5.54 6.46 2.2 4.2 ...
##  $ :&#39;data.frame&#39;:    118 obs. of  7 variables:
##   ..$ commune                     : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ total_employed_population   : int [1:118] 233130 18310 1780 870 1470 4130 2170 1050 1300 3140 ...
##   ..$ of_which_wage_earners       : int [1:118] 212530 16430 1620 780 1350 3820 1910 920 1100 2770 ...
##   ..$ of_which_non_wage_earners   : int [1:118] 20600 1880 160 90 120 310 260 130 200 370 ...
##   ..$ unemployed                  : int [1:118] 18806 988 106 29 73 260 80 41 72 169 ...
##   ..$ active_population           : int [1:118] 251936 19298 1886 899 1543 4390 2250 1091 1372 3309 ...
##   ..$ unemployment_rate_in_percent: num [1:118] 7.46 5.12 5.62 3.23 4.73 ...
##  $ :&#39;data.frame&#39;:    118 obs. of  7 variables:
##   ..$ commune                     : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ total_employed_population   : int [1:118] 236100 18380 1790 870 1470 4160 2160 1030 1330 3150 ...
##   ..$ of_which_wage_earners       : int [1:118] 215430 16500 1640 780 1350 3840 1900 900 1130 2780 ...
##   ..$ of_which_non_wage_earners   : int [1:118] 20670 1880 150 90 120 320 260 130 200 370 ...
##   ..$ unemployed                  : int [1:118] 18185 975 91 27 66 246 76 35 70 206 ...
##   ..$ active_population           : int [1:118] 254285 19355 1881 897 1536 4406 2236 1065 1400 3356 ...
##   ..$ unemployment_rate_in_percent: num [1:118] 7.15 5.04 4.84 3.01 4.3 ...</code></pre>
<p>So now, what if I want to know, for each dataset, which <em>communes</em> have an unemployment rate that is less than, say, 3%? For a single dataset I would do something like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">all_datasets <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="kw">filter</span>(., unemployment_rate_in_percent <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span>))</code></pre></div>
<pre><code>## [[1]]
##      commune total_employed_population of_which_wage_earners
## 1    Garnich                       844                   750
## 2 Leudelange                      1064                   937
## 3       Bech                       526                   463
##   of_which_non_wage_earners unemployed active_population
## 1                        94         25               869
## 2                       127         32              1096
## 3                        63         16               542
##   unemployment_rate_in_percent
## 1                     2.876870
## 2                     2.919708
## 3                     2.952030
## 
## [[2]]
##      commune total_employed_population of_which_wage_earners
## 1    Garnich                       845                   757
## 2 Leudelange                      1102                   965
## 3       Bech                       543                   476
## 4 Flaxweiler                       879                   789
##   of_which_non_wage_earners unemployed active_population
## 1                        88         19               864
## 2                       137         34              1136
## 3                        67         15               558
## 4                        90         27               906
##   unemployment_rate_in_percent
## 1                     2.199074
## 2                     2.992958
## 3                     2.688172
## 4                     2.980132
## 
## [[3]]
##   commune total_employed_population of_which_wage_earners
## 1    Bech                       520                   450
## 2    Bous                       750                   680
##   of_which_non_wage_earners unemployed active_population
## 1                        70         14               534
## 2                        70         22               772
##   unemployment_rate_in_percent
## 1                     2.621723
## 2                     2.849741
## 
## [[4]]
##             commune total_employed_population of_which_wage_earners
## 1 Reckange-sur-Mess                       980                   850
## 2              Bech                       520                   450
## 3          Betzdorf                      1500                  1350
## 4        Flaxweiler                       910                   820
##   of_which_non_wage_earners unemployed active_population
## 1                       130         30              1010
## 2                        70         11               531
## 3                       150         45              1545
## 4                        90         24               934
##   unemployment_rate_in_percent
## 1                     2.970297
## 2                     2.071563
## 3                     2.912621
## 4                     2.569593</code></pre>
<p>I know what you’re thinking… <em>what the hell?</em>. Let me explain: <code>map()</code> needs a function to map to each element of the list. <code>all_datasets</code> is the list to which I want to map the function. But what function? <code>filter()</code> is the function I need, so why doesn’t:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">all_datasets <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">map</span>(<span class="kw">filter</span>(unemployment_rate_in_percent <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span>))</code></pre></div>
<p>work? This is a bit complicated, and has to do with what is called environments. If you try to run the code above, you will get this error message:</p>
<pre><code>Error in filter(unemployment_rate_in_percent &lt; 3) :
  object &#39;unemployment_rate_in_percent&#39; not found</code></pre>
<p>I won’t go into details, but by writing <code>~filter(., unemployment_rate_in_percent &lt; 3)</code>, which is a formula (<code>~</code> is the symbol to define formulas, more on this in the later chapters), <code>map()</code> converts it to a function that can be used.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="reading-and-writing-data-with-rio.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="graphs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
