<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Modern R for STATEC</title>
  <meta name="description" content="In this book, statisticians and economists working at STATEC will learn how use R for their needs. Importing data, computing descriptive statistics, running regressions and generating reports are some of the topics covered. No previous experience with R is needed.">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="Modern R for STATEC" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="In this book, statisticians and economists working at STATEC will learn how use R for their needs. Importing data, computing descriptive statistics, running regressions and generating reports are some of the topics covered. No previous experience with R is needed." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Modern R for STATEC" />
  
  <meta name="twitter:description" content="In this book, statisticians and economists working at STATEC will learn how use R for their needs. Importing data, computing descriptive statistics, running regressions and generating reports are some of the topics covered. No previous experience with R is needed." />
  

<meta name="author" content="Bruno Rodrigues">


<meta name="date" content="2017-10-24">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="data-manipulation-and-descriptive-statistics.html">
<link rel="next" href="statistical-models.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Modern R for STATEC</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-is-r"><i class="fa fa-check"></i>What is R?</a></li>
<li><a href="index.html#why-modern-r">Why <em>modern</em> R?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-is-rstudio"><i class="fa fa-check"></i>What is Rstudio?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-are-packages"><i class="fa fa-check"></i>What are packages?</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#the-author"><i class="fa fa-check"></i>The author</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html"><i class="fa fa-check"></i><b>1</b> Getting to know Rstudio</a><ul>
<li class="chapter" data-level="1.1" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#panes"><i class="fa fa-check"></i><b>1.1</b> Panes</a></li>
<li class="chapter" data-level="1.2" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#console"><i class="fa fa-check"></i><b>1.2</b> Console</a></li>
<li class="chapter" data-level="1.3" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#scripts"><i class="fa fa-check"></i><b>1.3</b> Scripts</a><ul>
<li class="chapter" data-level="1.3.1" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#the-help-pane"><i class="fa fa-check"></i><b>1.3.1</b> The help pane</a></li>
<li class="chapter" data-level="1.3.2" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#the-environment-pane"><i class="fa fa-check"></i><b>1.3.2</b> The Environment pane</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#options"><i class="fa fa-check"></i><b>1.4</b> Options</a></li>
<li class="chapter" data-level="1.5" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#keyboard-shortcuts"><i class="fa fa-check"></i><b>1.5</b> Keyboard shortcuts</a></li>
<li class="chapter" data-level="1.6" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#projects"><i class="fa fa-check"></i><b>1.6</b> Projects</a></li>
<li class="chapter" data-level="1.7" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#history"><i class="fa fa-check"></i><b>1.7</b> History</a></li>
<li class="chapter" data-level="1.8" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#plots"><i class="fa fa-check"></i><b>1.8</b> Plots</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>2</b> Packages</a></li>
<li class="chapter" data-level="3" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html"><i class="fa fa-check"></i><b>3</b> Data types and objects</a><ul>
<li class="chapter" data-level="3.1" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-numeric-class"><i class="fa fa-check"></i><b>3.1</b> The <code>numeric</code> class</a></li>
<li class="chapter" data-level="3.2" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-character-class"><i class="fa fa-check"></i><b>3.2</b> The <code>character</code> class</a></li>
<li class="chapter" data-level="3.3" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#vectors-and-matrices"><i class="fa fa-check"></i><b>3.3</b> Vectors and matrices</a><ul>
<li class="chapter" data-level="3.3.1" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-c-function"><i class="fa fa-check"></i><b>3.3.1</b> The <code>c()</code> function</a></li>
<li class="chapter" data-level="3.3.2" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#cbind-and-rbind"><i class="fa fa-check"></i><b>3.3.2</b> <code>cbind()</code> and <code>rbind()</code></a></li>
<li class="chapter" data-level="3.3.3" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-matrix-class"><i class="fa fa-check"></i><b>3.3.3</b> The <code>matrix</code> class</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-logical-class"><i class="fa fa-check"></i><b>3.4</b> The <code>logical</code> class</a></li>
<li class="chapter" data-level="3.5" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-list-class"><i class="fa fa-check"></i><b>3.5</b> The <code>list</code> class</a></li>
<li class="chapter" data-level="3.6" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-data.frame-and-tibble-classes"><i class="fa fa-check"></i><b>3.6</b> The <code>data.frame</code> and <code>tibble</code> classes</a></li>
<li class="chapter" data-level="3.7" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#formulas"><i class="fa fa-check"></i><b>3.7</b> Formulas</a></li>
<li class="chapter" data-level="3.8" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercises"><i class="fa fa-check"></i><b>3.8</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-1"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="3.8.1" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-2"><i class="fa fa-check"></i><b>3.8.1</b> Exercise 2</a></li>
<li class="chapter" data-level="3.8.2" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-3"><i class="fa fa-check"></i><b>3.8.2</b> Exercise 3</a></li>
<li class="chapter" data-level="3.8.3" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-4"><i class="fa fa-check"></i><b>3.8.3</b> Exercise 4</a></li>
<li class="chapter" data-level="3.8.4" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-5"><i class="fa fa-check"></i><b>3.8.4</b> Exercise 5</a></li>
<li class="chapter" data-level="3.8.5" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-6"><i class="fa fa-check"></i><b>3.8.5</b> Exercise 6</a></li>
<li class="chapter" data-level="3.8.6" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-7"><i class="fa fa-check"></i><b>3.8.6</b> Exercise 7</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html"><i class="fa fa-check"></i><b>4</b> Reading and writing data</a><ul>
<li class="chapter" data-level="4.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#the-swiss-army-knife-of-data-import-and-export-rio"><i class="fa fa-check"></i><b>4.1</b> The swiss army knife of data import and export: <code>rio</code></a></li>
<li class="chapter" data-level="4.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#writing-any-object-to-disk"><i class="fa fa-check"></i><b>4.2</b> Writing any object to disk</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html"><i class="fa fa-check"></i><b>5</b> Data manipulation and descriptive statistics</a><ul>
<li class="chapter" data-level="5.1" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#working-with-a-single-dataset"><i class="fa fa-check"></i><b>5.1</b> Working with a single dataset</a><ul>
<li class="chapter" data-level="5.1.1" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#manipulating-and-creating-columns-with-dplyr"><i class="fa fa-check"></i><b>5.1.1</b> Manipulating and creating columns with <code>dplyr</code></a></li>
<li class="chapter" data-level="5.1.2" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#reshaping-data-with-tidyr"><i class="fa fa-check"></i><b>5.1.2</b> Reshaping data with <code>tidyr</code></a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#working-with-a-list-of-datasets"><i class="fa fa-check"></i><b>5.2</b> Working with a list of datasets</a><ul>
<li class="chapter" data-level="5.2.1" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#getting-to-know-map"><i class="fa fa-check"></i><b>5.2.1</b> Getting to know <code>map()</code></a></li>
<li class="chapter" data-level="5.2.2" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#getting-to-know-reduce"><i class="fa fa-check"></i><b>5.2.2</b> Getting to know <code>reduce()</code></a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#list-columns"><i class="fa fa-check"></i><b>5.3</b> List-columns</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="graphs.html"><a href="graphs.html"><i class="fa fa-check"></i><b>6</b> Graphs</a><ul>
<li class="chapter" data-level="6.1" data-path="graphs.html"><a href="graphs.html#resources"><i class="fa fa-check"></i><b>6.1</b> Resources</a></li>
<li class="chapter" data-level="6.2" data-path="graphs.html"><a href="graphs.html#examples"><i class="fa fa-check"></i><b>6.2</b> Examples</a><ul>
<li class="chapter" data-level="6.2.1" data-path="graphs.html"><a href="graphs.html#barplots"><i class="fa fa-check"></i><b>6.2.1</b> Barplots</a></li>
<li class="chapter" data-level="6.2.2" data-path="graphs.html"><a href="graphs.html#density"><i class="fa fa-check"></i><b>6.2.2</b> Density</a></li>
<li class="chapter" data-level="6.2.3" data-path="graphs.html"><a href="graphs.html#line-plots"><i class="fa fa-check"></i><b>6.2.3</b> Line plots</a></li>
<li class="chapter" data-level="6.2.4" data-path="graphs.html"><a href="graphs.html#facets"><i class="fa fa-check"></i><b>6.2.4</b> Facets</a></li>
<li class="chapter" data-level="6.2.5" data-path="graphs.html"><a href="graphs.html#pie-charts"><i class="fa fa-check"></i><b>6.2.5</b> Pie Charts</a></li>
<li class="chapter" data-level="6.2.6" data-path="graphs.html"><a href="graphs.html#adding-text-to-plots"><i class="fa fa-check"></i><b>6.2.6</b> Adding text to plots</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="graphs.html"><a href="graphs.html#customization"><i class="fa fa-check"></i><b>6.3</b> Customization</a><ul>
<li class="chapter" data-level="6.3.1" data-path="graphs.html"><a href="graphs.html#titles-axes-names-and-more"><i class="fa fa-check"></i><b>6.3.1</b> Titles, axes names and more</a></li>
<li class="chapter" data-level="6.3.2" data-path="graphs.html"><a href="graphs.html#themes"><i class="fa fa-check"></i><b>6.3.2</b> Themes</a></li>
<li class="chapter" data-level="6.3.3" data-path="graphs.html"><a href="graphs.html#colour-schemes-from-ggthemes"><i class="fa fa-check"></i><b>6.3.3</b> Colour schemes from <code>ggthemes</code></a></li>
<li class="chapter" data-level="6.3.4" data-path="graphs.html"><a href="graphs.html#using-your-own-colours"><i class="fa fa-check"></i><b>6.3.4</b> Using your own colours</a></li>
<li class="chapter" data-level="6.3.5" data-path="graphs.html"><a href="graphs.html#saving-plots-on-disk"><i class="fa fa-check"></i><b>6.3.5</b> Saving plots on disk</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="graphs.html"><a href="graphs.html#many-plots"><i class="fa fa-check"></i><b>6.4</b> Many plots</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="statistical-models.html"><a href="statistical-models.html"><i class="fa fa-check"></i><b>7</b> Statistical models</a><ul>
<li class="chapter" data-level="7.1" data-path="statistical-models.html"><a href="statistical-models.html#fitting-a-model-to-data"><i class="fa fa-check"></i><b>7.1</b> Fitting a model to data</a></li>
<li class="chapter" data-level="7.2" data-path="statistical-models.html"><a href="statistical-models.html#diagnostics"><i class="fa fa-check"></i><b>7.2</b> Diagnostics</a></li>
<li class="chapter" data-level="7.3" data-path="statistical-models.html"><a href="statistical-models.html#comparing-models"><i class="fa fa-check"></i><b>7.3</b> Comparing models</a></li>
<li class="chapter" data-level="7.4" data-path="statistical-models.html"><a href="statistical-models.html#using-a-model-for-prediction"><i class="fa fa-check"></i><b>7.4</b> Using a model for prediction</a></li>
<li class="chapter" data-level="7.5" data-path="statistical-models.html"><a href="statistical-models.html#beyond-linear-regression"><i class="fa fa-check"></i><b>7.5</b> Beyond linear regression</a></li>
<li class="chapter" data-level="7.6" data-path="statistical-models.html"><a href="statistical-models.html#advanced-topics"><i class="fa fa-check"></i><b>7.6</b> Advanced topics</a><ul>
<li class="chapter" data-level="7.6.1" data-path="statistical-models.html"><a href="statistical-models.html#bootstrapping"><i class="fa fa-check"></i><b>7.6.1</b> Bootstrapping</a></li>
<li class="chapter" data-level="7.6.2" data-path="statistical-models.html"><a href="statistical-models.html#cross-validation"><i class="fa fa-check"></i><b>7.6.2</b> Cross validation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="advanced-topics-1.html"><a href="advanced-topics-1.html"><i class="fa fa-check"></i><b>8</b> Advanced topics</a><ul>
<li class="chapter" data-level="8.1" data-path="advanced-topics-1.html"><a href="advanced-topics-1.html#for-and-while-loops"><i class="fa fa-check"></i><b>8.1</b> For and while loops</a></li>
<li class="chapter" data-level="8.2" data-path="advanced-topics-1.html"><a href="advanced-topics-1.html#programming-your-own-functions"><i class="fa fa-check"></i><b>8.2</b> Programming your own functions</a></li>
<li class="chapter" data-level="8.3" data-path="advanced-topics-1.html"><a href="advanced-topics-1.html#generating-pdf-or-word-reports-with-r"><i class="fa fa-check"></i><b>8.3</b> Generating Pdf or Word reports with R</a></li>
<li class="chapter" data-level="8.4" data-path="advanced-topics-1.html"><a href="advanced-topics-1.html#scraping-the-internet"><i class="fa fa-check"></i><b>8.4</b> Scraping the internet</a></li>
<li class="chapter" data-level="8.5" data-path="advanced-topics-1.html"><a href="advanced-topics-1.html#writing-your-own-package"><i class="fa fa-check"></i><b>8.5</b> Writing your own package</a></li>
<li class="chapter" data-level="8.6" data-path="advanced-topics-1.html"><a href="advanced-topics-1.html#random-tips-and-tricks"><i class="fa fa-check"></i><b>8.6</b> Random tips and tricks</a><ul>
<li class="chapter" data-level="8.6.1" data-path="advanced-topics-1.html"><a href="advanced-topics-1.html#creating-a-log-file"><i class="fa fa-check"></i><b>8.6.1</b> Creating a log file</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Modern R for STATEC</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="graphs" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Graphs</h1>
<p>By default, it is possible to make a lot of graphs with R without the need of any external packages. However, in this chapter, we are going to learn how to make graphs using <code>ggplot2</code> which is a very powerful package that produces amazing graphs. There is an entry cost to <code>ggplot2</code> as it works in a very different way than what you would expect, especially if you know how to make plots with the basic R functions already. But the resulting graphs are well worth the effort and once you’ll know more about <code>ggplot2</code> you’ll see that in a lot of situations it is actually faster and easier. Even if you are not interested in drawing plots, I advise you continue reading, as we will dig deeper into functional programming territory and learn how to graph an arbitrary large amount of plots with a few lines of code.</p>
<div id="resources" class="section level2">
<h2><span class="header-section-number">6.1</span> Resources</h2>
<p>Before showing some examples and the general functionality of <code>ggplot2</code>, I list here some online resources that I keep coming back to:</p>
<ul>
<li><p><a href="http://socviz.co/">Data Visualization for Social Science</a></p></li>
<li><p><a href="http://www.cookbook-r.com/Graphs/">R Graphics Cookbook</a></p></li>
<li><p><a href="http://www.r-graph-gallery.com/portfolio/ggplot2-package/">R graph gallery</a></p></li>
<li><p><a href="http://motioninsocial.com/tufte/">Tufte in R</a></p></li>
<li><p><a href="http://www.ggplot2-exts.org/gallery/">ggplot2 extensions</a></p></li>
<li><p><a href="https://cran.r-project.org/web/packages/ggthemes/vignettes/ggthemes.html">ggthemes Vignette</a></p></li>
<li><p><a href="https://www.rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf">ggplot2 cheatsheet</a></p></li>
</ul>
<p>I have a cookbook approach to using <code>ggplot2</code>; I try to find an example online that looks similar to what I have in mind, copy and paste the code and then adapt it to my case. The above resources are the ones I consult the most in these situations (I also go back to past code I’ve written, of course). Don’t hesitate to skim these resources for inspiration and to learn more about some extensions to <code>ggplot2</code>. In the next subsections I am going to show you how to draw the most common plots, as well as show you how to customize your plots with <code>ggthemes</code>.</p>
</div>
<div id="examples" class="section level2">
<h2><span class="header-section-number">6.2</span> Examples</h2>
<div id="barplots" class="section level3">
<h3><span class="header-section-number">6.2.1</span> Barplots</h3>
<p>To follow the examples below, load the following libraries:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(ggthemes)</code></pre></div>
<p><code>ggplot2</code> is an implementation of the <em>Grammar of Graphics</em> by <span class="citation">Wilkinson (<a href="#ref-wilkinson2006">2006</a>)</span>, but you don’t need to read the books to start using it. If we go back to the Star Wars data (contained in <code>dplyr</code>), and wish to draw a barplot of the gender, the following lines are enough:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(starwars, <span class="kw">aes</span>(gender)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>()</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-121-1.png" width="672" /></p>
<p>The first argument of the function is the data (called <code>starwars</code> in this example), and then the function <code>aes()</code>. This function is where you list the variables you want to map, and to quote the help file of <code>aes()</code>, <em>describes how the variables are mapped to visual properties (aesthetics) of geoms</em>. You can get different kind of plots by using different <code>geom_</code> functions.</p>
<p>You can also change the coordinate system in your barplot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(starwars, <span class="kw">aes</span>(gender)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-122-1.png" width="672" /></p>
</div>
<div id="density" class="section level3">
<h3><span class="header-section-number">6.2.2</span> Density</h3>
<p><code>geom_density()</code> is the <em>geom</em> that allows you to get density plots:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(starwars, <span class="kw">aes</span>(height)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>()</code></pre></div>
<pre><code>## Warning: Removed 6 rows containing non-finite values (stat_density).</code></pre>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-123-1.png" width="672" /></p>
<p>Let’s go into more detail now; what if you would like to plot the densities for females and males only (removing the droids from the data first)? This can be done by first filtering the data using <code>dplyr</code> and then separating the dataset by gender:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(gender <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;female&quot;</span>, <span class="st">&quot;male&quot;</span>))</code></pre></div>
<p>The above lines do the filtering; only keep gender if gender is in the vector <code>&quot;female&quot;, &quot;male&quot;</code>. This is much easier than having to write <code>gender == &quot;female&quot; | gender == &quot;male&quot;</code>. Then, we pipe this dataset to <code>ggplot</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(gender <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;female&quot;</span>, <span class="st">&quot;male&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(height, <span class="dt">fill =</span> gender)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>()</code></pre></div>
<pre><code>## Warning: Removed 5 rows containing non-finite values (stat_density).</code></pre>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-125-1.png" width="672" /></p>
<p>Let’s take a closer look to the <code>aes()</code> function: I’ve added <code>fill = gender</code>. This means that the there will be one density plot for each gender in the data, and each will be coloured accordingly. This is where <code>ggplot2</code> might be confusing; there is no need to write explicitly (even if it is possible) that you want the <em>female</em> density to be red and the <em>male</em> density to be blue. You just map the variable <code>gender</code> to this particular aesthetic. You conclude the plot by adding <code>geom_density()</code> which is this case is the plot you want. We will see later how to change the colours of your plot.</p>
</div>
<div id="line-plots" class="section level3">
<h3><span class="header-section-number">6.2.3</span> Line plots</h3>
<p>For the line plots, we are going to use official unemployment data (the same as in the previous chapter, but with all the available years). Get it from <a href="https://github.com/b-rodrigues/r_for_statec/tree/master/datasets/unemployment/all">here</a> (downloaded from: <a href="http://www.statistiques.public.lu/stat/TableViewer/tableView.aspx?ReportId=12950&amp;IF_Language=eng&amp;MainTheme=2&amp;FldrName=3&amp;RFPath=91" class="uri">http://www.statistiques.public.lu/stat/TableViewer/tableView.aspx?ReportId=12950&amp;IF_Language=eng&amp;MainTheme=2&amp;FldrName=3&amp;RFPath=91</a>).</p>
<p>Let’s plot the unemployment for the canton of Luxembourg only:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">unemp_lux_data =<span class="st"> </span><span class="kw">import</span>(<span class="st">&quot;datasets/unemployment/all/unemployment_lux_all.csv&quot;</span>)

unemp_lux_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(division <span class="op">==</span><span class="st"> &quot;Luxembourg&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, unemployment_rate_in_percent, <span class="dt">group =</span> <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-126-1.png" width="672" /></p>
<p>Because line plots are 2D, you need to specify the y and x axes. There is also another option you need to add, <code>group = 1</code>. This is to tell <code>aes()</code> that the dots have to be connected with a single line. What if you want to plot more than one commune?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">unemp_lux_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(division <span class="op">==</span><span class="st"> &quot;Luxembourg&quot;</span> <span class="op">|</span><span class="st"> </span>division <span class="op">==</span><span class="st"> &quot;Esch-sur-Alzette&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, unemployment_rate_in_percent, <span class="dt">group =</span> division, <span class="dt">colour =</span> division)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-127-1.png" width="672" /></p>
<p>This time, I’ve specified <code>group = division</code> which means that there has to be one line per as many communes as in the variable <code>division</code>. I do the same for colours. I think the next example illustrates how <code>ggplot2</code> is actually brilliant; if you need to add a third commune, there is no need to specify anything else; no need to add anything to the legend, no need to specify a third colour etc:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">unemp_lux_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(division <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Luxembourg&quot;</span>, <span class="st">&quot;Esch-sur-Alzette&quot;</span>, <span class="st">&quot;Wiltz&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, unemployment_rate_in_percent, <span class="dt">group =</span> division, <span class="dt">colour =</span> division)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-128-1.png" width="672" /></p>
</div>
<div id="facets" class="section level3">
<h3><span class="header-section-number">6.2.4</span> Facets</h3>
<p>In some case you have a factor variable that separates the data you wish to plot into different categories. If you want to have a plot per category you can use the <code>facet_grid()</code> function. Careful though, this function does not take a variable as an argument, but a formula, hence the <code>~</code> symbol in the code below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">human =</span> <span class="kw">case_when</span>(species <span class="op">==</span><span class="st"> &quot;Human&quot;</span> <span class="op">~</span><span class="st"> &quot;Human&quot;</span>,
                           species <span class="op">!=</span><span class="st"> &quot;Human&quot;</span> <span class="op">~</span><span class="st"> &quot;Not Human&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(gender <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;female&quot;</span>, <span class="st">&quot;male&quot;</span>), <span class="op">!</span><span class="kw">is.na</span>(human)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(height, <span class="dt">fill =</span> gender)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>human) <span class="op">+</span><span class="st"> </span><span class="co">#&lt;--- this is a formula</span>
<span class="st">  </span><span class="kw">geom_density</span>()</code></pre></div>
<pre><code>## Warning: Removed 4 rows containing non-finite values (stat_density).</code></pre>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-129-1.png" width="672" /></p>
<p>By changing the formula, you change how the facetting is done:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">human =</span> <span class="kw">case_when</span>(species <span class="op">==</span><span class="st"> &quot;Human&quot;</span> <span class="op">~</span><span class="st"> &quot;Human&quot;</span>,
                           species <span class="op">!=</span><span class="st"> &quot;Human&quot;</span> <span class="op">~</span><span class="st"> &quot;Not Human&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(gender <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;female&quot;</span>, <span class="st">&quot;male&quot;</span>), <span class="op">!</span><span class="kw">is.na</span>(human)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(height, <span class="dt">fill =</span> gender)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(human <span class="op">~</span><span class="st"> </span>.) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>()</code></pre></div>
<pre><code>## Warning: Removed 4 rows containing non-finite values (stat_density).</code></pre>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-130-1.png" width="672" /></p>
<p>Recall the categorical variable <code>more_1</code> that we computed in the previous chapter? Let’s use it as a faceting variable:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n_films =</span> <span class="kw">length</span>(films)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">more_1 =</span> <span class="kw">case_when</span>(n_films <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> &quot;Exactly one movie&quot;</span>,
                            n_films <span class="op">!=</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> &quot;More than 1 movie&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">human =</span> <span class="kw">case_when</span>(species <span class="op">==</span><span class="st"> &quot;Human&quot;</span> <span class="op">~</span><span class="st"> &quot;Human&quot;</span>,
                           species <span class="op">!=</span><span class="st"> &quot;Human&quot;</span> <span class="op">~</span><span class="st"> &quot;Not Human&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(gender <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;female&quot;</span>, <span class="st">&quot;male&quot;</span>), <span class="op">!</span><span class="kw">is.na</span>(human)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(height, <span class="dt">fill =</span> gender)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(human <span class="op">~</span><span class="st"> </span>more_<span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>()</code></pre></div>
<pre><code>## Warning: Removed 4 rows containing non-finite values (stat_density).</code></pre>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-131-1.png" width="672" /></p>
</div>
<div id="pie-charts" class="section level3">
<h3><span class="header-section-number">6.2.5</span> Pie Charts</h3>
<p>I am not a huge fan of pie charts, but sometimes this is what you have to do. So let’s see how you can create pie charts. First, let’s create a mock dataset with the function <code>tibble::tribble()</code> which allows you to create a dataset line by line:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">test_data &lt;-<span class="st"> </span><span class="kw">tribble</span>(
  <span class="op">~</span>id, <span class="op">~</span>var1, <span class="op">~</span>var2,  <span class="op">~</span>var3, <span class="op">~</span>var4, <span class="op">~</span>var5,
  <span class="st">&quot;a&quot;</span>, <span class="fl">26.5</span>, <span class="dv">38</span>, <span class="dv">30</span>, <span class="dv">32</span>, <span class="dv">34</span>,
  <span class="st">&quot;b&quot;</span>, <span class="dv">30</span>, <span class="dv">30</span>, <span class="dv">28</span>, <span class="dv">32</span>, <span class="dv">30</span>,
  <span class="st">&quot;c&quot;</span>, <span class="dv">34</span>, <span class="dv">32</span>, <span class="dv">30</span>, <span class="dv">28</span>, <span class="fl">26.5</span>
)</code></pre></div>
<p>This data is not in the right format though, which is wide. We need to have it in the long format for it to work with <code>ggplot2</code>. For this, let’s use <code>tidyr::gather()</code> as seen in the previous chapter:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">test_data_long =<span class="st"> </span>test_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(variable, value, <span class="kw">starts_with</span>(<span class="st">&quot;var&quot;</span>))</code></pre></div>
<p>Now, let’s plot this data, first by creating 3 bar plots:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(test_data_long) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>id) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(variable, value, <span class="dt">fill =</span> variable), <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>)</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-134-1.png" width="672" /></p>
<p>In the code above, I introduce a new option, called <code>stat = &quot;identity&quot;</code>. By default, <code>geom_bar()</code> counts the number of observations of each category that is plotted, which is a statistical transformation. By adding <code>stat = &quot;identity&quot;</code>, I force the statistical transformation to be the identity function, and thus plot the data as is.</p>
<p>To create the pie chart, first we need to compute the share of each <code>id</code> to <code>var1</code>, <code>var2</code>, etc…</p>
<p>To do this, we first group by <code>id</code>, then compute the total. Then we use a new function <code>ungroup()</code>. After using <code>ungroup()</code> all the computations are done on the whole dataset instead of by group, which is what we need to compute the share:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">test_data_long =<span class="st"> </span>test_data_long <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(id) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">total =</span> <span class="kw">sum</span>(value)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">share =</span> value<span class="op">/</span>total)</code></pre></div>
<p>Let’s take a look to see if this is what we wanted:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(test_data_long)</code></pre></div>
<pre><code>## # A tibble: 15 x 5
##       id variable value total     share
##    &lt;chr&gt;    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
##  1     a     var1  26.5 160.5 0.1651090
##  2     b     var1  30.0 150.0 0.2000000
##  3     c     var1  34.0 150.5 0.2259136
##  4     a     var2  38.0 160.5 0.2367601
##  5     b     var2  30.0 150.0 0.2000000
##  6     c     var2  32.0 150.5 0.2126246
##  7     a     var3  30.0 160.5 0.1869159
##  8     b     var3  28.0 150.0 0.1866667
##  9     c     var3  30.0 150.5 0.1993355
## 10     a     var4  32.0 160.5 0.1993769
## 11     b     var4  32.0 150.0 0.2133333
## 12     c     var4  28.0 150.5 0.1860465
## 13     a     var5  34.0 160.5 0.2118380
## 14     b     var5  30.0 150.0 0.2000000
## 15     c     var5  26.5 150.5 0.1760797</code></pre>
<p>If you didn’t understand what <code>ungroup()</code> did, rerun the last few lines with it and inspect the output.</p>
<p>To plot the pie chart, we create a barplot again, but specify polar coordinates:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(test_data_long) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>id) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">y =</span> share, <span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">fill =</span> variable), <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_polar</span>(<span class="st">&quot;y&quot;</span>, <span class="dt">start =</span> <span class="dv">0</span>)</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-137-1.png" width="672" /></p>
<p>As you can see, this typical pie chart is not very easy to read; compared to the barplots above it is not easy to distinguish <code>a</code> from <code>b</code> from <code>c</code>. It is possible to amend the pie chart a bit to make it clearer, by specifying <code>variable</code> as the <code>x</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(test_data_long) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>id) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">y =</span> share, <span class="dt">x =</span> variable, <span class="dt">fill =</span> variable), <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_polar</span>(<span class="st">&quot;x&quot;</span>, <span class="dt">start =</span> <span class="dv">0</span>)</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-138-1.png" width="672" /></p>
<p>But as a general rule, avoid pie charts if possible. Barplots show the same information, much, much clearer.</p>
</div>
<div id="adding-text-to-plots" class="section level3">
<h3><span class="header-section-number">6.2.6</span> Adding text to plots</h3>
<p>Sometimes you might want to add some text to your plots. This is possible with <code>geom_text()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(test_data_long) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>id) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(variable, value, <span class="dt">fill =</span> variable), <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(variable, value <span class="op">+</span><span class="st"> </span><span class="fl">1.5</span>, <span class="dt">label =</span> value))</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-139-1.png" width="672" /></p>
<p>You can put anything after <code>label =</code>but in general what you’d want are the values, so that’s what I put there. But you can also refine it, imagine the values are actualy, say €:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(test_data_long) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>id) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(variable, value, <span class="dt">fill =</span> variable), <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(variable, value <span class="op">+</span><span class="st"> </span><span class="fl">1.5</span>, <span class="dt">label =</span> <span class="kw">paste</span>(value, <span class="st">&quot;€&quot;</span>)))</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-140-1.png" width="672" /></p>
</div>
</div>
<div id="customization" class="section level2">
<h2><span class="header-section-number">6.3</span> Customization</h2>
<p>Every plot you’ve seen until now was made with the default look of <code>ggplot2</code>. If you want to change the look, you can apply a theme, and a colour scheme. Let’s take a look at themes first by using the ones found in the package <code>ggthemes</code>. But first, let’s learn how to change the names of the axes and how to title a plot.</p>
<div id="titles-axes-names-and-more" class="section level3">
<h3><span class="header-section-number">6.3.1</span> Titles, axes names and more</h3>
<p>To change the title of the plot, and of the axes, you need to pass the names to the <code>labs()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">unemp_lux_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(division <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Luxembourg&quot;</span>, <span class="st">&quot;Esch-sur-Alzette&quot;</span>, <span class="st">&quot;Wiltz&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, unemployment_rate_in_percent, <span class="dt">group =</span> division, <span class="dt">colour =</span> division)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Unemployment in Luxembourg, Esch/Alzette and Wiltz&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Rate&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-141-1.png" width="672" /></p>
<p>What if you want to make the lines thicker?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">unemp_lux_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(division <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Luxembourg&quot;</span>, <span class="st">&quot;Esch-sur-Alzette&quot;</span>, <span class="st">&quot;Wiltz&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, unemployment_rate_in_percent, <span class="dt">group =</span> division, <span class="dt">colour =</span> division)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Unemployment in Luxembourg, Esch/Alzette and Wiltz&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Rate&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-142-1.png" width="672" /></p>
</div>
<div id="themes" class="section level3">
<h3><span class="header-section-number">6.3.2</span> Themes</h3>
<p>Let’s go back to the unemployment line plots. For now, let’s keep the base <code>ggplot2</code> theme, but modify it a bit. For example, the legend placement is actually a feature of the theme. This means that if you want to change where the legend is placed you need to modify this feature from the theme. This is done with the function <code>theme()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">unemp_lux_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(division <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Luxembourg&quot;</span>, <span class="st">&quot;Esch-sur-Alzette&quot;</span>, <span class="st">&quot;Wiltz&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, unemployment_rate_in_percent, <span class="dt">group =</span> division, <span class="dt">colour =</span> division)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Unemployment in Luxembourg, Esch/Alzette and Wiltz&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Rate&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-143-1.png" width="672" /></p>
<p>What I also like to do is remove the title of the legend, because it is often superfluous:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">unemp_lux_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(division <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Luxembourg&quot;</span>, <span class="st">&quot;Esch-sur-Alzette&quot;</span>, <span class="st">&quot;Wiltz&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, unemployment_rate_in_percent, <span class="dt">group =</span> division, <span class="dt">colour =</span> division)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>, <span class="dt">legend.title =</span> <span class="kw">element_blank</span>()) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Unemployment in Luxembourg, Esch/Alzette and Wiltz&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Rate&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-144-1.png" width="672" /></p>
<p>The legend title has to be an <code>element_text</code> object.<code>element_text</code> objects are used with <code>theme</code> to specify how text should be displayed. <code>element_blank()</code> draws nothing and assigns no space (not even blank space).</p>
<p>You could modify every feature of the theme like that, but there are built-in themes that you can use:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">unemp_lux_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(division <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Luxembourg&quot;</span>, <span class="st">&quot;Esch-sur-Alzette&quot;</span>, <span class="st">&quot;Wiltz&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, unemployment_rate_in_percent, <span class="dt">group =</span> division, <span class="dt">colour =</span> division)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>, <span class="dt">legend.title =</span> <span class="kw">element_blank</span>()) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Unemployment in Luxembourg, Esch/Alzette and Wiltz&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Rate&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-145-1.png" width="672" /></p>
<p>For example in the code above, I have used <code>theme_minimal()</code> which I like quite a lot. You can also use themes from the <code>ggthemes</code> package, which even contains a STATA theme, if you like it:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">unemp_lux_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(division <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Luxembourg&quot;</span>, <span class="st">&quot;Esch-sur-Alzette&quot;</span>, <span class="st">&quot;Wiltz&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, unemployment_rate_in_percent, <span class="dt">group =</span> division, <span class="dt">colour =</span> division)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_stata</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Unemployment in Luxembourg, Esch/Alzette and Wiltz&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Rate&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-146-1.png" width="672" /></p>
<p>As you can see, <code>theme_stata()</code> has the legend on the bottom by default, because this is how the legend position is defined within the theme. However the legend title is still there. Let’s remove it:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">unemp_lux_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(division <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Luxembourg&quot;</span>, <span class="st">&quot;Esch-sur-Alzette&quot;</span>, <span class="st">&quot;Wiltz&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, unemployment_rate_in_percent, <span class="dt">group =</span> division, <span class="dt">colour =</span> division)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_stata</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.title =</span> <span class="kw">element_blank</span>()) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Unemployment in Luxembourg, Esch/Alzette and Wiltz&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Rate&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-147-1.png" width="672" /></p>
<p><code>ggthemes</code> even features an Excel 2003 theme (don’t use it though):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">unemp_lux_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(division <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Luxembourg&quot;</span>, <span class="st">&quot;Esch-sur-Alzette&quot;</span>, <span class="st">&quot;Wiltz&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, unemployment_rate_in_percent, <span class="dt">group =</span> division, <span class="dt">colour =</span> division)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_excel</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Unemployment in Luxembourg, Esch/Alzette and Wiltz&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Rate&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-148-1.png" width="672" /></p>
</div>
<div id="colour-schemes-from-ggthemes" class="section level3">
<h3><span class="header-section-number">6.3.3</span> Colour schemes from <code>ggthemes</code></h3>
<p>You can also change colour schemes, by specifying either <code>scale_colour_*</code> or <code>scale_fill_*</code> functions. <code>scale_colour_*</code> functions are used for continuous variables, while <code>scale_fill_*</code> functions for discrete variables (so for barplots for example). A colour scheme I like is the <a href="https://www.highcharts.com/">Highcharts</a> colour scheme.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">unemp_lux_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(division <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Luxembourg&quot;</span>, <span class="st">&quot;Esch-sur-Alzette&quot;</span>, <span class="st">&quot;Wiltz&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, unemployment_rate_in_percent, <span class="dt">group =</span> division, <span class="dt">colour =</span> division)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_colour_hc</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>, <span class="dt">legend.title =</span> <span class="kw">element_blank</span>()) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Unemployment in Luxembourg, Esch/Alzette and Wiltz&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Rate&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-149-1.png" width="672" /></p>
<p>An example with a barplot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(test_data_long) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>id) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(variable, value, <span class="dt">fill =</span> variable), <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(variable, value <span class="op">+</span><span class="st"> </span><span class="fl">1.5</span>, <span class="dt">label =</span> value)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_hc</span>()</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-150-1.png" width="672" /></p>
</div>
<div id="using-your-own-colours" class="section level3">
<h3><span class="header-section-number">6.3.4</span> Using your own colours</h3>
<p>To use your own colours you can use <code>scale_colour_manual()</code> and <code>scale_fill_manual()</code> and specify the html codes of the colours you want to use.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">unemp_lux_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(division <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Luxembourg&quot;</span>, <span class="st">&quot;Esch-sur-Alzette&quot;</span>, <span class="st">&quot;Wiltz&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, unemployment_rate_in_percent, <span class="dt">group =</span> division, <span class="dt">colour =</span> division)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_colour_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;#FF336C&quot;</span>, <span class="st">&quot;#334BFF&quot;</span>, <span class="st">&quot;#2CAE00&quot;</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>, <span class="dt">legend.title =</span> <span class="kw">element_blank</span>()) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Unemployment in Luxembourg, Esch/Alzette and Wiltz&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Rate&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-151-1.png" width="672" /></p>
<p>To get html codes of colours you can use <a href="http://htmlcolorcodes.com/color-picker/">this online tool</a>. There is also a very nice package, called <code>colourpicker</code> that allows you to pick colours from with RStudio. Also, you do not even need to load it to use it, since it comes with an Addin:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;pics/rstudio_colourpicker.gif&quot;</span>)</code></pre></div>
<p><img src="pics/rstudio_colourpicker.gif" /><!-- --></p>
<p>For a barplot you would do the same:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(test_data_long) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>id) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(variable, value, <span class="dt">fill =</span> variable), <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(variable, value <span class="op">+</span><span class="st"> </span><span class="fl">1.5</span>, <span class="dt">label =</span> value)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>, <span class="dt">legend.title =</span> <span class="kw">element_blank</span>()) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;#FF336C&quot;</span>, <span class="st">&quot;#334BFF&quot;</span>, <span class="st">&quot;#2CAE00&quot;</span>, <span class="st">&quot;#B3C9C6&quot;</span>, <span class="st">&quot;#765234&quot;</span>))</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-153-1.png" width="672" /></p>
</div>
<div id="saving-plots-on-disk" class="section level3">
<h3><span class="header-section-number">6.3.5</span> Saving plots on disk</h3>
<p>There are two ways to save plots on disk; one through the <em>Plots</em> in RStudio and another using the <code>ggsave()</code> function. Using RStudio, navigate to the <em>Plots</em> pane and click on <em>Export</em>. You can then choose where to save the plot and other various options:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;pics/rstudio_save_plots.gif&quot;</span>)</code></pre></div>
<p><img src="pics/rstudio_save_plots.gif" /><!-- --></p>
<p>This is fine if you only generate one or two plots but if you generate a large number of them, it is less tedious to use the <code>ggsave()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_plot1 =<span class="st"> </span><span class="kw">ggplot</span>(my_data) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(variable))

<span class="kw">ggsave</span>(<span class="st">&quot;path/you/want/to/save/the/plot/to/my_plot1.pdf&quot;</span>, my_plot1)</code></pre></div>
<p>There are other options that you can specify such as the width and height, resolution, units, etc…</p>
</div>
</div>
<div id="many-plots" class="section level2">
<h2><span class="header-section-number">6.4</span> Many plots</h2>
<p>In this section, we are going to learn how to use the possibilities offered by the <code>purrr</code> package and how it can work together with <code>ggplot2</code> to generate many plots. This is a more advanced topic, but what comes next is also what makes R, and the functional programming paradigm so powerful.</p>
<p>For example, suppose that instead of wanting a single plot with the unemployment rate of each commune, you need one unemployment plot, per commune:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">unemp_lux_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(division <span class="op">==</span><span class="st"> &quot;Luxembourg&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, unemployment_rate_in_percent, <span class="dt">group =</span> division)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Unemployment in Luxembourg&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Rate&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-156-1.png" width="672" /></p>
<p>and then you would write the same for “Esch-sur-Alzette” and also for “Wiltz”. If you only have to make to make these 3 plots, copy and pasting the above lines is no big deal:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">unemp_lux_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(division <span class="op">==</span><span class="st"> &quot;Esch-sur-Alzette&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, unemployment_rate_in_percent, <span class="dt">group =</span> division)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Unemployment in Esch-sur-Alzette&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Rate&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-157-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">unemp_lux_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(division <span class="op">==</span><span class="st"> &quot;Wiltz&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, unemployment_rate_in_percent, <span class="dt">group =</span> division)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Unemployment in Esch-sur-Alzette&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Rate&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-157-2.png" width="672" /></p>
<p>Put copy and pasting is error prone. Can you spot the copy-paste mistake I made? And what if you have to create the above plots for all 108 Luxembourguish communes? That’s a lot of copy pasting. What if, once you are done copy pasting, you have to change something, for example, the theme? You could use the search and replace function of RStudio, true, but sometimes search and replace can also introduce bugs and typos. You can avoid all these issues by using <code>purrr::map()</code>. What do you need to map over? The commune names. So let’s create a vector of commune names:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">communes =<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;Luxembourg&quot;</span>, <span class="st">&quot;Esch-sur-Alzette&quot;</span>, <span class="st">&quot;Wiltz&quot;</span>)</code></pre></div>
<p>Now we can create the graphs using <code>map()</code>, or <code>map2()</code> to be exact:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plots_tibble =<span class="st"> </span>unemp_lux_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(division <span class="op">%in%</span><span class="st"> </span>communes) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(division) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">plot =</span> <span class="kw">map2</span>(<span class="dt">.x =</span> data, <span class="dt">.y =</span> division, <span class="op">~</span><span class="kw">ggplot</span>(<span class="dt">data =</span> .x) <span class="op">+</span>
<span class="st">       </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">       </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(year, unemployment_rate_in_percent, <span class="dt">group =</span> <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">       </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="kw">paste</span>(<span class="st">&quot;Unemployment in&quot;</span>, .y))))</code></pre></div>
<p>Let’s study this line by line: the first line is easy, we simply use <code>filter()</code> to keep only the communes we are interested in. Then we group by <code>division</code> and use <code>tidyr::nest()</code>. As a refresher, let’s take a look at what this does:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">unemp_lux_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(division <span class="op">%in%</span><span class="st"> </span>communes) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(division) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">nest</span>()</code></pre></div>
<pre><code>## # A tibble: 3 x 2
##           division              data
##              &lt;chr&gt;            &lt;list&gt;
## 1 Esch-sur-Alzette &lt;tibble [15 x 7]&gt;
## 2       Luxembourg &lt;tibble [15 x 7]&gt;
## 3            Wiltz &lt;tibble [15 x 7]&gt;</code></pre>
<p>This creates a tibble with two columns, <code>division</code> and <code>data</code>, where each individual (or commune in this case) is another tibble with all the original variables. This is very useful, because now we can pass these tibbles to <code>map2()</code>, to generate the plots. But why <code>map2()</code> and what’s the difference with <code>map()</code>? <code>map2()</code> works the same way as <code>map()</code>, but maps over two inputs:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">numbers1 =<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)

numbers2 =<span class="st"> </span><span class="kw">list</span>(<span class="dv">9</span>, <span class="dv">8</span>, <span class="dv">7</span>, <span class="dv">6</span>, <span class="dv">5</span>)

<span class="kw">map2</span>(numbers1, numbers2, <span class="st">`</span><span class="dt">*</span><span class="st">`</span>)</code></pre></div>
<pre><code>## [[1]]
## [1] 9
## 
## [[2]]
## [1] 16
## 
## [[3]]
## [1] 21
## 
## [[4]]
## [1] 24
## 
## [[5]]
## [1] 25</code></pre>
<p>In our example with the graphs, the two inputs are the data, and the names of the communes. This is useful to create the title with <code>labs(title = paste(&quot;Unemployment in&quot;, .y))))</code> where <code>.y</code> is the second input of <code>map2()</code>, the commune names contained in variable <code>division</code>.</p>
<p>So what happened? We now have a tibble called <code>plots_tibble</code> that looks like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(plots_tibble)</code></pre></div>
<pre><code>## # A tibble: 3 x 3
##           division              data     plot
##              &lt;chr&gt;            &lt;list&gt;   &lt;list&gt;
## 1 Esch-sur-Alzette &lt;tibble [15 x 7]&gt; &lt;S3: gg&gt;
## 2       Luxembourg &lt;tibble [15 x 7]&gt; &lt;S3: gg&gt;
## 3            Wiltz &lt;tibble [15 x 7]&gt; &lt;S3: gg&gt;</code></pre>
<p>This tibble contains three columns, <code>division</code>, <code>data</code> and now a new one called <code>plot</code>, that we created before using the last line <code>mutate(plot = ...)</code> (remember that <code>mutate()</code> adds columns to tibbles). <code>plot</code> is a list-column, with elements… being plots! Yes you read that right, the elements of the column <code>plot</code> are literally plots. This is what I meant with list columns. Let’s see what is inside the <code>data</code> and the <code>plot</code> columns exactly:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plots_tibble <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">pull</span>(data)</code></pre></div>
<pre><code>## [[1]]
## # A tibble: 15 x 7
##     year active_population of_which_non_wage_earners of_which_wage_earners
##    &lt;chr&gt;             &lt;dbl&gt;                     &lt;dbl&gt;                 &lt;dbl&gt;
##  1  2001            11.339                       665                10.113
##  2  2002            11.675                       677                10.302
##  3  2003            11.718                       674                10.231
##  4  2004            12.187                       659                10.629
##  5  2005            11.944                       654                10.338
##  6  2006            12.233                       657                10.510
##  7  2007            12.558                       634                10.893
##  8  2008            12.869                       638                10.955
##  9  2009            13.236                       652                11.007
## 10  2010            13.555                       638                11.183
## 11  2011            13.869                       630                11.469
## 12  2012            14.344                       684                11.831
## 13  2013            14.779                       694                12.031
## 14  2014            15.152                       703                12.452
## 15  2015            15.341                       710                12.600
## # ... with 3 more variables: total_employed_population &lt;dbl&gt;,
## #   unemployed &lt;dbl&gt;, unemployment_rate_in_percent &lt;dbl&gt;
## 
## [[2]]
## # A tibble: 15 x 7
##     year active_population of_which_non_wage_earners of_which_wage_earners
##    &lt;chr&gt;             &lt;dbl&gt;                     &lt;dbl&gt;                 &lt;dbl&gt;
##  1  2001            34.391                     2.891                30.357
##  2  2002            34.802                     2.939                30.298
##  3  2003            35.195                     3.030                30.130
##  4  2004            35.561                     3.059                30.110
##  5  2005            35.611                     3.134                29.833
##  6  2006            35.454                     3.118                30.309
##  7  2007            36.133                     3.254                31.118
##  8  2008            37.510                     3.393                31.885
##  9  2009            37.924                     3.487                31.590
## 10  2010            38.626                     3.543                32.123
## 11  2011            40.326                     3.660                33.552
## 12  2012            41.824                     3.810                34.640
## 13  2013            43.368                     3.982                35.531
## 14  2014            44.604                     4.107                36.661
## 15  2015            45.221                     4.140                37.510
## # ... with 3 more variables: total_employed_population &lt;dbl&gt;,
## #   unemployed &lt;dbl&gt;, unemployment_rate_in_percent &lt;dbl&gt;
## 
## [[3]]
## # A tibble: 15 x 7
##     year active_population of_which_non_wage_earners of_which_wage_earners
##    &lt;chr&gt;             &lt;dbl&gt;                     &lt;dbl&gt;                 &lt;dbl&gt;
##  1  2001             2.131                       223                 1.786
##  2  2002             2.138                       220                 1.784
##  3  2003             2.180                       223                 1.794
##  4  2004             2.237                       227                 1.854
##  5  2005             2.263                       229                 1.847
##  6  2006             2.202                       206                 1.815
##  7  2007             2.273                       198                 1.878
##  8  2008             2.298                       200                 1.897
##  9  2009             2.362                       201                 1.945
## 10  2010             2.423                       195                 1.972
## 11  2011             2.476                       190                 2.017
## 12  2012             2.588                       188                 2.099
## 13  2013             2.662                       195                 2.149
## 14  2014             2.692                       185                 2.192
## 15  2015             2.771                       180                 2.270
## # ... with 3 more variables: total_employed_population &lt;dbl&gt;,
## #   unemployed &lt;dbl&gt;, unemployment_rate_in_percent &lt;dbl&gt;</code></pre>
<p>each element of data is a tibble for the specific country with columns <code>year</code>, <code>active_population</code>, etc, the original columns. But obviously, there is no <code>division</code> column. So to plot the data, and join all the dots together, we need to add <code>group = 1</code> in the call to <code>ggplot2()</code> (whereas if you plot multiple lines in the same graph, you need to write <code>group = division</code>).</p>
<p>But more interestingly, how can you actually see the plots? If you want to simply look at them, it is enough to use <code>pull()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plots_tibble <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">pull</span>(plot)</code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-164-1.png" width="672" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-164-2.png" width="672" /></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-164-3.png" width="672" /></p>
<p>And if we want to save these plots, we can do so using <code>map2()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map2</span>(<span class="kw">paste0</span>(plots_tibble<span class="op">$</span>division, <span class="st">&quot;.pdf&quot;</span>), plots_tibble<span class="op">$</span>plot, ggsave)</code></pre></div>
<pre><code>Saving 7 x 5 in image
Saving 6.01 x 3.94 in image
Saving 6.01 x 3.94 in image</code></pre>
<p>This was probably the most advanced topic we have studied yet; but you probably agree with me that it is among the most useful ones. This section is a perfect illustration of the power of functional programming; you can mix and match functions as long as you give them the correct arguments. You can pass data to functions that use data and then pass these functions to other functions that use functions as arguments, such as <code>map()</code>.<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a> <code>map()</code> does not care if the functions you pass to it produces tables, graphs or even another function. <code>map()</code> will simply map this function to a list of inputs, and as long as these inputs are correct arguments to the function, <code>map()</code> will do its magic. If you combine this with list-columns, you can even use <code>map()</code> alongside <code>dplyr</code> functions and map your function by first grouping, filtering, etc…</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-wilkinson2006">
<p>Wilkinson, Leland. 2006. <em>The Grammar of Graphics</em>. Springer Science &amp; Business Media.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="3">
<li id="fn3"><p>Functions that have other functions as input are called <em>higher order functions</em><a href="graphs.html#fnref3">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-manipulation-and-descriptive-statistics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="statistical-models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
