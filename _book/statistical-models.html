<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Modern R for STATEC</title>
  <meta name="description" content="In this book, statisticians and economists working at STATEC will learn how use R for their needs. Importing data, computing descriptive statistics, running regressions and generating reports are some of the topics covered. No previous experience with R is needed.">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="Modern R for STATEC" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="In this book, statisticians and economists working at STATEC will learn how use R for their needs. Importing data, computing descriptive statistics, running regressions and generating reports are some of the topics covered. No previous experience with R is needed." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Modern R for STATEC" />
  
  <meta name="twitter:description" content="In this book, statisticians and economists working at STATEC will learn how use R for their needs. Importing data, computing descriptive statistics, running regressions and generating reports are some of the topics covered. No previous experience with R is needed." />
  

<meta name="author" content="Bruno Rodrigues">


<meta name="date" content="2017-10-25">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="graphs.html">
<link rel="next" href="advanced-topics-1.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Modern R for STATEC</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-is-r"><i class="fa fa-check"></i>What is R?</a></li>
<li><a href="index.html#why-modern-r">Why <em>modern</em> R?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-is-rstudio"><i class="fa fa-check"></i>What is Rstudio?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-are-packages"><i class="fa fa-check"></i>What are packages?</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#the-author"><i class="fa fa-check"></i>The author</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html"><i class="fa fa-check"></i><b>1</b> Getting to know Rstudio</a><ul>
<li class="chapter" data-level="1.1" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#panes"><i class="fa fa-check"></i><b>1.1</b> Panes</a></li>
<li class="chapter" data-level="1.2" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#console"><i class="fa fa-check"></i><b>1.2</b> Console</a></li>
<li class="chapter" data-level="1.3" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#scripts"><i class="fa fa-check"></i><b>1.3</b> Scripts</a><ul>
<li class="chapter" data-level="1.3.1" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#the-help-pane"><i class="fa fa-check"></i><b>1.3.1</b> The help pane</a></li>
<li class="chapter" data-level="1.3.2" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#the-environment-pane"><i class="fa fa-check"></i><b>1.3.2</b> The Environment pane</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#options"><i class="fa fa-check"></i><b>1.4</b> Options</a></li>
<li class="chapter" data-level="1.5" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#keyboard-shortcuts"><i class="fa fa-check"></i><b>1.5</b> Keyboard shortcuts</a></li>
<li class="chapter" data-level="1.6" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#projects"><i class="fa fa-check"></i><b>1.6</b> Projects</a></li>
<li class="chapter" data-level="1.7" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#history"><i class="fa fa-check"></i><b>1.7</b> History</a></li>
<li class="chapter" data-level="1.8" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#plots"><i class="fa fa-check"></i><b>1.8</b> Plots</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>2</b> Packages</a></li>
<li class="chapter" data-level="3" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html"><i class="fa fa-check"></i><b>3</b> Data types and objects</a><ul>
<li class="chapter" data-level="3.1" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-numeric-class"><i class="fa fa-check"></i><b>3.1</b> The <code>numeric</code> class</a></li>
<li class="chapter" data-level="3.2" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-character-class"><i class="fa fa-check"></i><b>3.2</b> The <code>character</code> class</a></li>
<li class="chapter" data-level="3.3" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#vectors-and-matrices"><i class="fa fa-check"></i><b>3.3</b> Vectors and matrices</a><ul>
<li class="chapter" data-level="3.3.1" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-c-function"><i class="fa fa-check"></i><b>3.3.1</b> The <code>c()</code> function</a></li>
<li class="chapter" data-level="3.3.2" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#cbind-and-rbind"><i class="fa fa-check"></i><b>3.3.2</b> <code>cbind()</code> and <code>rbind()</code></a></li>
<li class="chapter" data-level="3.3.3" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-matrix-class"><i class="fa fa-check"></i><b>3.3.3</b> The <code>matrix</code> class</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-logical-class"><i class="fa fa-check"></i><b>3.4</b> The <code>logical</code> class</a></li>
<li class="chapter" data-level="3.5" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-list-class"><i class="fa fa-check"></i><b>3.5</b> The <code>list</code> class</a></li>
<li class="chapter" data-level="3.6" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-data.frame-and-tibble-classes"><i class="fa fa-check"></i><b>3.6</b> The <code>data.frame</code> and <code>tibble</code> classes</a></li>
<li class="chapter" data-level="3.7" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#formulas"><i class="fa fa-check"></i><b>3.7</b> Formulas</a></li>
<li class="chapter" data-level="3.8" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercises"><i class="fa fa-check"></i><b>3.8</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-1"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="3.8.1" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-2"><i class="fa fa-check"></i><b>3.8.1</b> Exercise 2</a></li>
<li class="chapter" data-level="3.8.2" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-3"><i class="fa fa-check"></i><b>3.8.2</b> Exercise 3</a></li>
<li class="chapter" data-level="3.8.3" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-4"><i class="fa fa-check"></i><b>3.8.3</b> Exercise 4</a></li>
<li class="chapter" data-level="3.8.4" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-5"><i class="fa fa-check"></i><b>3.8.4</b> Exercise 5</a></li>
<li class="chapter" data-level="3.8.5" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-6"><i class="fa fa-check"></i><b>3.8.5</b> Exercise 6</a></li>
<li class="chapter" data-level="3.8.6" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-7"><i class="fa fa-check"></i><b>3.8.6</b> Exercise 7</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html"><i class="fa fa-check"></i><b>4</b> Reading and writing data</a><ul>
<li class="chapter" data-level="4.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#the-swiss-army-knife-of-data-import-and-export-rio"><i class="fa fa-check"></i><b>4.1</b> The swiss army knife of data import and export: <code>rio</code></a></li>
<li class="chapter" data-level="4.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#writing-any-object-to-disk"><i class="fa fa-check"></i><b>4.2</b> Writing any object to disk</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html"><i class="fa fa-check"></i><b>5</b> Data manipulation and descriptive statistics</a><ul>
<li class="chapter" data-level="5.1" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#working-with-a-single-dataset"><i class="fa fa-check"></i><b>5.1</b> Working with a single dataset</a><ul>
<li class="chapter" data-level="5.1.1" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#manipulating-and-creating-columns-with-dplyr"><i class="fa fa-check"></i><b>5.1.1</b> Manipulating and creating columns with <code>dplyr</code></a></li>
<li class="chapter" data-level="5.1.2" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#reshaping-data-with-tidyr"><i class="fa fa-check"></i><b>5.1.2</b> Reshaping data with <code>tidyr</code></a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#working-with-a-list-of-datasets"><i class="fa fa-check"></i><b>5.2</b> Working with a list of datasets</a><ul>
<li class="chapter" data-level="5.2.1" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#getting-to-know-map"><i class="fa fa-check"></i><b>5.2.1</b> Getting to know <code>map()</code></a></li>
<li class="chapter" data-level="5.2.2" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#getting-to-know-reduce"><i class="fa fa-check"></i><b>5.2.2</b> Getting to know <code>reduce()</code></a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#list-columns"><i class="fa fa-check"></i><b>5.3</b> List-columns</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="graphs.html"><a href="graphs.html"><i class="fa fa-check"></i><b>6</b> Graphs</a><ul>
<li class="chapter" data-level="6.1" data-path="graphs.html"><a href="graphs.html#resources"><i class="fa fa-check"></i><b>6.1</b> Resources</a></li>
<li class="chapter" data-level="6.2" data-path="graphs.html"><a href="graphs.html#examples"><i class="fa fa-check"></i><b>6.2</b> Examples</a><ul>
<li class="chapter" data-level="6.2.1" data-path="graphs.html"><a href="graphs.html#barplots"><i class="fa fa-check"></i><b>6.2.1</b> Barplots</a></li>
<li class="chapter" data-level="6.2.2" data-path="graphs.html"><a href="graphs.html#density"><i class="fa fa-check"></i><b>6.2.2</b> Density</a></li>
<li class="chapter" data-level="6.2.3" data-path="graphs.html"><a href="graphs.html#line-plots"><i class="fa fa-check"></i><b>6.2.3</b> Line plots</a></li>
<li class="chapter" data-level="6.2.4" data-path="graphs.html"><a href="graphs.html#facets"><i class="fa fa-check"></i><b>6.2.4</b> Facets</a></li>
<li class="chapter" data-level="6.2.5" data-path="graphs.html"><a href="graphs.html#pie-charts"><i class="fa fa-check"></i><b>6.2.5</b> Pie Charts</a></li>
<li class="chapter" data-level="6.2.6" data-path="graphs.html"><a href="graphs.html#adding-text-to-plots"><i class="fa fa-check"></i><b>6.2.6</b> Adding text to plots</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="graphs.html"><a href="graphs.html#customization"><i class="fa fa-check"></i><b>6.3</b> Customization</a><ul>
<li class="chapter" data-level="6.3.1" data-path="graphs.html"><a href="graphs.html#titles-axes-names-and-more"><i class="fa fa-check"></i><b>6.3.1</b> Titles, axes names and more</a></li>
<li class="chapter" data-level="6.3.2" data-path="graphs.html"><a href="graphs.html#themes"><i class="fa fa-check"></i><b>6.3.2</b> Themes</a></li>
<li class="chapter" data-level="6.3.3" data-path="graphs.html"><a href="graphs.html#colour-schemes-from-ggthemes"><i class="fa fa-check"></i><b>6.3.3</b> Colour schemes from <code>ggthemes</code></a></li>
<li class="chapter" data-level="6.3.4" data-path="graphs.html"><a href="graphs.html#using-your-own-colours"><i class="fa fa-check"></i><b>6.3.4</b> Using your own colours</a></li>
<li class="chapter" data-level="6.3.5" data-path="graphs.html"><a href="graphs.html#saving-plots-on-disk"><i class="fa fa-check"></i><b>6.3.5</b> Saving plots on disk</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="graphs.html"><a href="graphs.html#many-plots"><i class="fa fa-check"></i><b>6.4</b> Many plots</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="statistical-models.html"><a href="statistical-models.html"><i class="fa fa-check"></i><b>7</b> Statistical models</a><ul>
<li class="chapter" data-level="7.1" data-path="statistical-models.html"><a href="statistical-models.html#fitting-a-model-to-data"><i class="fa fa-check"></i><b>7.1</b> Fitting a model to data</a></li>
<li class="chapter" data-level="7.2" data-path="statistical-models.html"><a href="statistical-models.html#diagnostics"><i class="fa fa-check"></i><b>7.2</b> Diagnostics</a></li>
<li class="chapter" data-level="7.3" data-path="statistical-models.html"><a href="statistical-models.html#comparing-models"><i class="fa fa-check"></i><b>7.3</b> Comparing models</a></li>
<li class="chapter" data-level="7.4" data-path="statistical-models.html"><a href="statistical-models.html#using-a-model-for-prediction"><i class="fa fa-check"></i><b>7.4</b> Using a model for prediction</a></li>
<li class="chapter" data-level="7.5" data-path="statistical-models.html"><a href="statistical-models.html#beyond-linear-regression"><i class="fa fa-check"></i><b>7.5</b> Beyond linear regression</a></li>
<li class="chapter" data-level="7.6" data-path="statistical-models.html"><a href="statistical-models.html#advanced-topics"><i class="fa fa-check"></i><b>7.6</b> Advanced topics</a><ul>
<li class="chapter" data-level="7.6.1" data-path="statistical-models.html"><a href="statistical-models.html#bootstrapping"><i class="fa fa-check"></i><b>7.6.1</b> Bootstrapping</a></li>
<li class="chapter" data-level="7.6.2" data-path="statistical-models.html"><a href="statistical-models.html#cross-validation"><i class="fa fa-check"></i><b>7.6.2</b> Cross-validation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="advanced-topics-1.html"><a href="advanced-topics-1.html"><i class="fa fa-check"></i><b>8</b> Advanced topics</a><ul>
<li class="chapter" data-level="8.1" data-path="advanced-topics-1.html"><a href="advanced-topics-1.html#for-and-while-loops"><i class="fa fa-check"></i><b>8.1</b> For and while loops</a></li>
<li class="chapter" data-level="8.2" data-path="advanced-topics-1.html"><a href="advanced-topics-1.html#programming-your-own-functions"><i class="fa fa-check"></i><b>8.2</b> Programming your own functions</a></li>
<li class="chapter" data-level="8.3" data-path="advanced-topics-1.html"><a href="advanced-topics-1.html#generating-pdf-or-word-reports-with-r"><i class="fa fa-check"></i><b>8.3</b> Generating Pdf or Word reports with R</a></li>
<li class="chapter" data-level="8.4" data-path="advanced-topics-1.html"><a href="advanced-topics-1.html#scraping-the-internet"><i class="fa fa-check"></i><b>8.4</b> Scraping the internet</a></li>
<li class="chapter" data-level="8.5" data-path="advanced-topics-1.html"><a href="advanced-topics-1.html#writing-your-own-package"><i class="fa fa-check"></i><b>8.5</b> Writing your own package</a></li>
<li class="chapter" data-level="8.6" data-path="advanced-topics-1.html"><a href="advanced-topics-1.html#random-tips-and-tricks"><i class="fa fa-check"></i><b>8.6</b> Random tips and tricks</a><ul>
<li class="chapter" data-level="8.6.1" data-path="advanced-topics-1.html"><a href="advanced-topics-1.html#creating-a-log-file"><i class="fa fa-check"></i><b>8.6.1</b> Creating a log file</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Modern R for STATEC</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="statistical-models" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> Statistical models</h1>
<p>In this chapter, we will not learn about all the models out there that you may or may not need. Instead, I will show you how can use what you have learned until now and how you can apply these concepts to modeling. Also, as you read in the beginning of the book, R has many many packages. So the model you need is most probably already implemented in some package.</p>
<div id="fitting-a-model-to-data" class="section level2">
<h2><span class="header-section-number">7.1</span> Fitting a model to data</h2>
<p>Suppose you have a variable <code>y</code> that you wish to explain using a set of other variables <code>x1</code>, <code>x2</code>, <code>x3</code>, etc. Let’s take a look at the <code>Housing</code> dataset from the <code>Ecdat</code> package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(Ecdat)

<span class="kw">data</span>(Housing)</code></pre></div>
<p>You can read a description of the dataset by running:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">?Housing</code></pre></div>
<pre><code>Housing                 package:Ecdat                  R Documentation

Sales Prices of Houses in the City of Windsor

Description:

     a cross-section from 1987

     _number of observations_ : 546

     _observation_ : goods

     _country_ : Canada

Usage:

     data(Housing)

Format:

     A dataframe containing :

     price: sale price of a house

     lotsize: the lot size of a property in square feet

     bedrooms: number of bedrooms

     bathrms: number of full bathrooms

     stories: number of stories excluding basement

     driveway: does the house has a driveway ?

     recroom: does the house has a recreational room ?

     fullbase: does the house has a full finished basement ?

     gashw: does the house uses gas for hot water heating ?

     airco: does the house has central air conditioning ?

     garagepl: number of garage places

     prefarea: is the house located in the preferred neighbourhood of the city ?

Source:

     Anglin, P.M.  and R.  Gencay https://help.github.com/articles/error-permission-denied-publickey/#platform-mac(1996) “Semiparametric estimation of
     a hedonic price function”, _Journal of Applied Econometrics_,
     *11(6)*, 633-648.

References:

     Verbeek, Marno (2004) _A Guide to Modern Econometrics_, John Wiley
     and Sons, chapter 3.

     Journal of Applied Econometrics data archive : &lt;URL:
     http://qed.econ.queensu.ca/jae/&gt;.

See Also:

     ‘Index.Source’, ‘Index.Economics’, ‘Index.Econometrics’,
     ‘Index.Observations’</code></pre>
<p>or by looking for <code>Housing</code> in the help pane of RStudio. Usually, you would take a look a the data before doing any modeling:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glimpse</span>(Housing)</code></pre></div>
<pre><code>## Observations: 546
## Variables: 12
## $ price    &lt;dbl&gt; 42000, 38500, 49500, 60500, 61000, 66000, 66000, 6900...
## $ lotsize  &lt;dbl&gt; 5850, 4000, 3060, 6650, 6360, 4160, 3880, 4160, 4800,...
## $ bedrooms &lt;dbl&gt; 3, 2, 3, 3, 2, 3, 3, 3, 3, 3, 3, 2, 3, 3, 2, 2, 3, 4,...
## $ bathrms  &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 2, 1, 1, 2, 2, 1, 1, 1, 1, 1, 1, 1,...
## $ stories  &lt;dbl&gt; 2, 1, 1, 2, 1, 1, 2, 3, 1, 4, 1, 1, 2, 1, 1, 1, 2, 3,...
## $ driveway &lt;fctr&gt; yes, yes, yes, yes, yes, yes, yes, yes, yes, yes, ye...
## $ recroom  &lt;fctr&gt; no, no, no, yes, no, yes, no, no, yes, yes, no, no, ...
## $ fullbase &lt;fctr&gt; yes, no, no, no, no, yes, yes, no, yes, no, yes, no,...
## $ gashw    &lt;fctr&gt; no, no, no, no, no, no, no, no, no, no, no, no, no, ...
## $ airco    &lt;fctr&gt; no, no, no, no, no, yes, no, no, no, yes, yes, no, n...
## $ garagepl &lt;dbl&gt; 1, 0, 0, 0, 0, 0, 2, 0, 0, 1, 3, 0, 0, 0, 0, 0, 1, 0,...
## $ prefarea &lt;fctr&gt; no, no, no, no, no, no, no, no, no, no, no, no, no, ...</code></pre>
<p>Housing prices depend on a set of variables such as the number of bedrooms, the area it is located and so on. If you believe that housing prices depend linearly on a set of explanatory variables, you will want to estimate a linear model. To estimate a <em>linear model</em>, you will need to use the built-in <code>lm()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model1 =<span class="st"> </span><span class="kw">lm</span>(price <span class="op">~</span><span class="st"> </span>lotsize <span class="op">+</span><span class="st"> </span>bedrooms, <span class="dt">data =</span> Housing)</code></pre></div>
<p><code>lm()</code> takes a formula as an argument, which defines the model you want to estimate. In this case, I ran the following regression:</p>
<p><span class="math display">\[
\text{price} = \alpha + \beta_1 * \text{lotsize} + \beta_2 * \text{bedrooms} + \varepsilon
\]</span></p>
<p>where <span class="math inline">\(alpha, beta_1\)</span> and <span class="math inline">\(beta_2\)</span> are three parameters to estimate. To take a look at the results, you can use the <code>summary()</code> method (not to be confused with <code>dplyr::summarise()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(model1)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = price ~ lotsize + bedrooms, data = Housing)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -65665 -12498  -2075   8970  97205 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 5.613e+03  4.103e+03   1.368    0.172    
## lotsize     6.053e+00  4.243e-01  14.265  &lt; 2e-16 ***
## bedrooms    1.057e+04  1.248e+03   8.470 2.31e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 21230 on 543 degrees of freedom
## Multiple R-squared:  0.3703, Adjusted R-squared:  0.3679 
## F-statistic: 159.6 on 2 and 543 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>if you wish to remove the intercept (<span class="math inline">\(alpha\)</span>) from your model, you can do so with <code>-1</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model2 =<span class="st"> </span><span class="kw">lm</span>(price <span class="op">~</span><span class="st"> </span><span class="op">-</span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>lotsize <span class="op">+</span><span class="st"> </span>bedrooms, <span class="dt">data =</span> Housing)

<span class="kw">summary</span>(model2)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = price ~ -1 + lotsize + bedrooms, data = Housing)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -67229 -12342  -1333   9627  95509 
## 
## Coefficients:
##           Estimate Std. Error t value Pr(&gt;|t|)    
## lotsize      6.283      0.390   16.11   &lt;2e-16 ***
## bedrooms 11968.362    713.194   16.78   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 21250 on 544 degrees of freedom
## Multiple R-squared:  0.916,  Adjusted R-squared:  0.9157 
## F-statistic:  2965 on 2 and 544 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>or if you want to use all the columns inside <code>Housing</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model3 =<span class="st"> </span><span class="kw">lm</span>(price <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> Housing)

<span class="kw">summary</span>(model3)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = price ~ ., data = Housing)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -41389  -9307   -591   7353  74875 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -4038.3504  3409.4713  -1.184 0.236762    
## lotsize         3.5463     0.3503  10.124  &lt; 2e-16 ***
## bedrooms     1832.0035  1047.0002   1.750 0.080733 .  
## bathrms     14335.5585  1489.9209   9.622  &lt; 2e-16 ***
## stories      6556.9457   925.2899   7.086 4.37e-12 ***
## drivewayyes  6687.7789  2045.2458   3.270 0.001145 ** 
## recroomyes   4511.2838  1899.9577   2.374 0.017929 *  
## fullbaseyes  5452.3855  1588.0239   3.433 0.000642 ***
## gashwyes    12831.4063  3217.5971   3.988 7.60e-05 ***
## aircoyes    12632.8904  1555.0211   8.124 3.15e-15 ***
## garagepl     4244.8290   840.5442   5.050 6.07e-07 ***
## prefareayes  9369.5132  1669.0907   5.614 3.19e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 15420 on 534 degrees of freedom
## Multiple R-squared:  0.6731, Adjusted R-squared:  0.6664 
## F-statistic: 99.97 on 11 and 534 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>You can access different elements of <code>model3</code> (for example) with <code>$</code>, because the result of <code>lm()</code> is a list:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(model3<span class="op">$</span>coefficients)</code></pre></div>
<pre><code>##  (Intercept)      lotsize     bedrooms      bathrms      stories 
## -4038.350425     3.546303  1832.003466 14335.558468  6556.945711 
##  drivewayyes   recroomyes  fullbaseyes     gashwyes     aircoyes 
##  6687.778890  4511.283826  5452.385539 12831.406266 12632.890405 
##     garagepl  prefareayes 
##  4244.829004  9369.513239</code></pre>
<p>but I prefer to use the <code>broom</code> package, and more specifically the <code>tidy()</code> function, which converts <code>model3</code> into a neat <code>data.frame</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">results3 =<span class="st"> </span><span class="kw">tidy</span>(model3)

<span class="kw">glimpse</span>(results3)</code></pre></div>
<pre><code>## Observations: 12
## Variables: 5
## $ term      &lt;chr&gt; &quot;(Intercept)&quot;, &quot;lotsize&quot;, &quot;bedrooms&quot;, &quot;bathrms&quot;, &quot;st...
## $ estimate  &lt;dbl&gt; -4038.350425, 3.546303, 1832.003466, 14335.558468, 6...
## $ std.error &lt;dbl&gt; 3409.4713, 0.3503, 1047.0002, 1489.9209, 925.2899, 2...
## $ statistic &lt;dbl&gt; -1.184451, 10.123618, 1.749764, 9.621691, 7.086369, ...
## $ p.value   &lt;dbl&gt; 2.367616e-01, 3.732442e-22, 8.073341e-02, 2.570369e-...</code></pre>
<p>this is useful, because you can then work on the results easily, for example if you wish to only keep results that are significant at the 5% level:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">results3 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(p.value <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>)</code></pre></div>
<pre><code>##           term     estimate std.error statistic      p.value
## 1      lotsize     3.546303    0.3503 10.123618 3.732442e-22
## 2      bathrms 14335.558468 1489.9209  9.621691 2.570369e-20
## 3      stories  6556.945711  925.2899  7.086369 4.374046e-12
## 4  drivewayyes  6687.778890 2045.2458  3.269914 1.145151e-03
## 5   recroomyes  4511.283826 1899.9577  2.374413 1.792936e-02
## 6  fullbaseyes  5452.385539 1588.0239  3.433440 6.422381e-04
## 7     gashwyes 12831.406266 3217.5971  3.987885 7.595575e-05
## 8     aircoyes 12632.890405 1555.0211  8.123935 3.150681e-15
## 9     garagepl  4244.829004  840.5442  5.050096 6.069790e-07
## 10 prefareayes  9369.513239 1669.0907  5.613544 3.189602e-08</code></pre>
<p>You can even add new columns, such as the confidence intervals:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">results3 =<span class="st"> </span><span class="kw">tidy</span>(model3, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>, <span class="dt">conf.level =</span> <span class="fl">0.95</span>)

<span class="kw">print</span>(results3)</code></pre></div>
<pre><code>##           term     estimate std.error statistic      p.value      conf.low
## 1  (Intercept) -4038.350425 3409.4713 -1.184451 2.367616e-01 -10735.971609
## 2      lotsize     3.546303    0.3503 10.123618 3.732442e-22      2.858168
## 3     bedrooms  1832.003466 1047.0002  1.749764 8.073341e-02   -224.740890
## 4      bathrms 14335.558468 1489.9209  9.621691 2.570369e-20  11408.733579
## 5      stories  6556.945711  925.2899  7.086369 4.374046e-12   4739.291087
## 6  drivewayyes  6687.778890 2045.2458  3.269914 1.145151e-03   2670.064534
## 7   recroomyes  4511.283826 1899.9577  2.374413 1.792936e-02    778.975864
## 8  fullbaseyes  5452.385539 1588.0239  3.433440 6.422381e-04   2332.845419
## 9     gashwyes 12831.406266 3217.5971  3.987885 7.595575e-05   6510.705975
## 10    aircoyes 12632.890405 1555.0211  8.123935 3.150681e-15   9578.181593
## 11    garagepl  4244.829004  840.5442  5.050096 6.069790e-07   2593.650266
## 12 prefareayes  9369.513239 1669.0907  5.613544 3.189602e-08   6090.724248
##       conf.high
## 1   2659.270758
## 2      4.234438
## 3   3888.747822
## 4  17262.383357
## 5   8374.600336
## 6  10705.493247
## 7   8243.591788
## 8   8571.925660
## 9  19152.106558
## 10 15687.599216
## 11  5896.007742
## 12 12648.302230</code></pre>
<p>Going back to model estimation, you can of course use <code>lm()</code> in a pipe workflow:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Housing <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>driveway, <span class="op">-</span>stories) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">lm</span>(price <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> .) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">tidy</span>()</code></pre></div>
<pre><code>##           term     estimate    std.error  statistic      p.value
## 1  (Intercept)  3025.444622 3262.7421099  0.9272705 3.542034e-01
## 2      lotsize     3.667398    0.3631201 10.0996837 4.515215e-22
## 3     bedrooms  4139.606144 1036.2909312  3.9946370 7.384906e-05
## 4      bathrms 16443.499226 1546.3153358 10.6339883 4.293340e-24
## 5   recroomyes  5659.653940 2010.1645778  2.8155177 5.049110e-03
## 6  fullbaseyes  2241.223601 1618.2288335  1.3849856 1.666330e-01
## 7     gashwyes 13568.262325 3411.4247037  3.9773008 7.927588e-05
## 8     aircoyes 15578.013392 1597.3098060  9.7526562 8.528322e-21
## 9     garagepl  4232.001307  882.8269365  4.7936930 2.123831e-06
## 10 prefareayes 10728.842007 1753.2560499  6.1193811 1.814759e-09</code></pre>
<p>The first <code>.</code> in the <code>lm()</code> function is used to indicate that we wish to use all the data from <code>Housing</code> (minus <code>driveway</code> and <code>stories</code> which I removed using <code>select()</code> and the <code>-</code> sign), and the second <code>.</code> is used to <em>place</em> the result from the two <code>dplyr</code> instructions that preceded is to be placed there. The picture below should help you understand:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;pics/pipe_to_second_position.png&quot;</span>)</code></pre></div>
<p><img src="pics/pipe_to_second_position.png" width="288" /></p>
<p>You have to specify this, because by default, when using <code>%&gt;%</code> the left hand side argument gets passed as the first argument of the function on the right hand side.</p>
</div>
<div id="diagnostics" class="section level2">
<h2><span class="header-section-number">7.2</span> Diagnostics</h2>
<p>Diagnostics are useful metrics to assess model fit. You can read some of these diagnostics, such as the <span class="math inline">\(R^2\)</span> at the bottom of the summary (when running <code>summary(my_model)</code>), but if you want to do more than simply reading these diagnostics from RStudio, you can put those in a <code>data.frame</code> too, using <code>broom::glance()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glance</span>(model3)</code></pre></div>
<pre><code>##   r.squared adj.r.squared    sigma statistic       p.value df    logLik
## 1 0.6731236     0.6663902 15423.19  99.96774 6.177731e-122 12 -6034.094
##        AIC      BIC     deviance df.residual
## 1 12094.19 12150.12 127025071644         534</code></pre>
<p>You can also plot the usual diagnostics plots using <code>ggfortify::autoplot()</code> which uses the <code>ggplot2</code> package under the hood:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggfortify)

<span class="kw">autoplot</span>(model3, <span class="dt">which =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_minimal</span>()</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-181-1.png" width="672" /></p>
<p><code>which=1:6</code> is an additional option that shows you all the diagnostics plot. If you omit this option, you will only get 4 of them.</p>
<p>You can also get the residuals of the regression in two ways; either you grab them directly from the model fit:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">resi3 =<span class="st"> </span><span class="kw">residuals</span>(model3)</code></pre></div>
<p>or you can augment the original data with a residuals column, using <code>broom::augment()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">housing_aug =<span class="st"> </span><span class="kw">augment</span>(model3)</code></pre></div>
<p>Let’s take a look at <code>housing_aug</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glimpse</span>(housing_aug)</code></pre></div>
<pre><code>## Observations: 546
## Variables: 19
## $ price      &lt;dbl&gt; 42000, 38500, 49500, 60500, 61000, 66000, 66000, 69...
## $ lotsize    &lt;dbl&gt; 5850, 4000, 3060, 6650, 6360, 4160, 3880, 4160, 480...
## $ bedrooms   &lt;dbl&gt; 3, 2, 3, 3, 2, 3, 3, 3, 3, 3, 3, 2, 3, 3, 2, 2, 3, ...
## $ bathrms    &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 2, 1, 1, 2, 2, 1, 1, 1, 1, 1, 1, ...
## $ stories    &lt;dbl&gt; 2, 1, 1, 2, 1, 1, 2, 3, 1, 4, 1, 1, 2, 1, 1, 1, 2, ...
## $ driveway   &lt;fctr&gt; yes, yes, yes, yes, yes, yes, yes, yes, yes, yes, ...
## $ recroom    &lt;fctr&gt; no, no, no, yes, no, yes, no, no, yes, yes, no, no...
## $ fullbase   &lt;fctr&gt; yes, no, no, no, no, yes, yes, no, yes, no, yes, n...
## $ gashw      &lt;fctr&gt; no, no, no, no, no, no, no, no, no, no, no, no, no...
## $ airco      &lt;fctr&gt; no, no, no, no, no, yes, no, no, no, yes, yes, no,...
## $ garagepl   &lt;dbl&gt; 1, 0, 0, 0, 0, 0, 2, 0, 0, 1, 3, 0, 0, 0, 0, 0, 1, ...
## $ prefarea   &lt;fctr&gt; no, no, no, no, no, no, no, no, no, no, no, no, no...
## $ .fitted    &lt;dbl&gt; 66037.98, 41391.15, 39889.63, 63689.09, 49760.43, 6...
## $ .se.fit    &lt;dbl&gt; 1790.507, 1406.500, 1534.102, 2262.056, 1567.689, 2...
## $ .resid     &lt;dbl&gt; -24037.9757, -2891.1515, 9610.3699, -3189.0873, 112...
## $ .hat       &lt;dbl&gt; 0.013477335, 0.008316321, 0.009893730, 0.021510891,...
## $ .sigma     &lt;dbl&gt; 15402.01, 15437.14, 15431.98, 15437.02, 15429.89, 1...
## $ .cooksd    &lt;dbl&gt; 2.803214e-03, 2.476265e-05, 3.265481e-04, 8.004787e...
## $ .std.resid &lt;dbl&gt; -1.56917096, -0.18823924, 0.62621736, -0.20903274, ...</code></pre>
<p>A few columns have been added to the original data, among them <code>.resid</code> which contains the residuals. Let’s plot them:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(housing_aug) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(.resid))</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-186-1.png" width="672" /></p>
<p>Fitted values are also added to the original data, under the variable <code>.fitted</code>. It would also have been possible to get the fitted values with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit3 =<span class="st"> </span><span class="kw">fitted</span>(model3)</code></pre></div>
<p>but I prefer using <code>augment()</code>, because the columns get merged to the original data, which then makes it easier to find specific individuals, for example, you might want to know for which housing units the model underestimates the price:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">total_pos =<span class="st"> </span>housing_aug <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(.resid <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">pull</span>(total)</code></pre></div>
<p>we find that 261 individuals where the residuals are positive. It is also easier to extract outliers:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">housing_aug <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prank =</span> <span class="kw">cume_dist</span>(.cooksd)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(prank <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.99</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">glimpse</span>()</code></pre></div>
<pre><code>## Observations: 6
## Variables: 20
## $ price      &lt;dbl&gt; 163000, 125000, 132000, 175000, 190000, 174500
## $ lotsize    &lt;dbl&gt; 7420, 4320, 3500, 9960, 7420, 7500
## $ bedrooms   &lt;dbl&gt; 4, 3, 4, 3, 4, 4
## $ bathrms    &lt;dbl&gt; 1, 1, 2, 2, 2, 2
## $ stories    &lt;dbl&gt; 2, 2, 2, 2, 3, 2
## $ driveway   &lt;fctr&gt; yes, yes, yes, yes, yes, yes
## $ recroom    &lt;fctr&gt; yes, no, no, no, no, no
## $ fullbase   &lt;fctr&gt; yes, yes, no, yes, no, yes
## $ gashw      &lt;fctr&gt; no, yes, yes, no, no, no
## $ airco      &lt;fctr&gt; yes, no, no, no, yes, yes
## $ garagepl   &lt;dbl&gt; 2, 2, 2, 2, 2, 3
## $ prefarea   &lt;fctr&gt; no, no, no, yes, yes, yes
## $ .fitted    &lt;dbl&gt; 94826.68, 77688.37, 85495.58, 108563.18, 115125.03,...
## $ .se.fit    &lt;dbl&gt; 2520.691, 3551.954, 3544.961, 2589.680, 2185.603, 2...
## $ .resid     &lt;dbl&gt; 68173.32, 47311.63, 46504.42, 66436.82, 74874.97, 5...
## $ .hat       &lt;dbl&gt; 0.02671105, 0.05303793, 0.05282929, 0.02819317, 0.0...
## $ .sigma     &lt;dbl&gt; 15144.70, 15293.34, 15298.27, 15159.14, 15085.99, 1...
## $ .cooksd    &lt;dbl&gt; 0.04590995, 0.04637969, 0.04461464, 0.04616068, 0.0...
## $ .std.resid &lt;dbl&gt; 4.480428, 3.152300, 3.098176, 4.369631, 4.904193, 3...
## $ prank      &lt;dbl&gt; 0.9963370, 1.0000000, 0.9945055, 0.9981685, 0.99267...</code></pre>
<p><code>prank</code> is a variable I created with <code>cume_dist()</code> which is a <code>dplyr</code> function that returns the proportion of all values less than or equal to the current rank. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">example =<span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>, <span class="fl">4.6</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="fl">0.8</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>)
<span class="kw">cume_dist</span>(example)</code></pre></div>
<pre><code>## [1] 1.0000000 0.8571429 0.7142857 0.5714286 0.4285714 0.2857143 0.1428571</code></pre>
<p>by filtering <code>prank &gt; 0.99</code> we get the top 1% of outliers according to Cook’s distance.</p>
</div>
<div id="comparing-models" class="section level2">
<h2><span class="header-section-number">7.3</span> Comparing models</h2>
<p>Let’s estimate another model on the same data; prices are only positive, so a linear regression might not be the best model, because the model allows for negative prices. Let’s look at the distribution of prices:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(Housing) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(price))</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-191-1.png" width="672" /></p>
<p>it looks like taking the log of <code>price</code> might provide a better fit:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model_log =<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(price) <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> Housing)

result_log =<span class="st"> </span><span class="kw">tidy</span>(model_log)

<span class="kw">print</span>(result_log)</code></pre></div>
<pre><code>##           term     estimate    std.error  statistic      p.value
## 1  (Intercept) 1.002556e+01 4.724349e-02 212.210317 0.000000e+00
## 2      lotsize 5.057053e-05 4.853947e-06  10.418435 2.908737e-23
## 3     bedrooms 3.402048e-02 1.450780e-02   2.344978 1.939345e-02
## 4      bathrms 1.677687e-01 2.064515e-02   8.126299 3.096505e-15
## 5      stories 9.227447e-02 1.282132e-02   7.196956 2.098439e-12
## 6  drivewayyes 1.306513e-01 2.834004e-02   4.610130 5.040563e-06
## 7   recroomyes 7.351654e-02 2.632685e-02   2.792455 5.418509e-03
## 8  fullbaseyes 9.939967e-02 2.200452e-02   4.517238 7.717764e-06
## 9     gashwyes 1.783545e-01 4.458477e-02   4.000347 7.217517e-05
## 10    aircoyes 1.780197e-01 2.154722e-02   8.261841 1.138204e-15
## 11    garagepl 5.075683e-02 1.164704e-02   4.357918 1.575321e-05
## 12 prefareayes 1.271134e-01 2.312783e-02   5.496122 6.021383e-08</code></pre>
<p>Let’s take a look at the diagnostics:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glance</span>(model_log)</code></pre></div>
<pre><code>##   r.squared adj.r.squared     sigma statistic       p.value df   logLik
## 1  0.676591      0.669929 0.2137121    101.56 3.666219e-123 12 73.87312
##         AIC       BIC deviance df.residual
## 1 -121.7462 -65.81219  24.3893         534</code></pre>
<p>Let’s compare these to the ones from the previous model:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diag_lm =<span class="st"> </span><span class="kw">glance</span>(model3)

diag_lm =<span class="st"> </span>diag_lm <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="st">&quot;lin-lin model&quot;</span>)

diag_log =<span class="st"> </span><span class="kw">glance</span>(model_log)

diag_log =<span class="st"> </span>diag_log <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="st">&quot;log-lin model&quot;</span>)

diagnostics_models =<span class="st"> </span><span class="kw">full_join</span>(diag_lm, diag_log)</code></pre></div>
<pre><code>## Joining, by = c(&quot;r.squared&quot;, &quot;adj.r.squared&quot;, &quot;sigma&quot;, &quot;statistic&quot;, &quot;p.value&quot;, &quot;df&quot;, &quot;logLik&quot;, &quot;AIC&quot;, &quot;BIC&quot;, &quot;deviance&quot;, &quot;df.residual&quot;, &quot;model&quot;)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(diagnostics_models)</code></pre></div>
<pre><code>##   r.squared adj.r.squared        sigma statistic       p.value df
## 1 0.6731236     0.6663902 1.542319e+04  99.96774 6.177731e-122 12
## 2 0.6765910     0.6699290 2.137121e-01 101.56000 3.666219e-123 12
##        logLik        AIC         BIC     deviance df.residual
## 1 -6034.09400 12094.1880 12150.12204 1.270251e+11         534
## 2    73.87312  -121.7462   -65.81219 2.438930e+01         534
##           model
## 1 lin-lin model
## 2 log-lin model</code></pre>
<p>I saved the diagnostics in two different <code>data.frame</code> using the <code>glance()</code> function and added a <code>model</code> column to indicate which model the diagnostics come from. Then I merged both datasets using <code>full_join()</code>, a <code>dplyr</code> function.</p>
<p>As you can see, the model with the logarithm of the prices as the explained variable has a higher likelihood (and thus lower AIC and BIC) than the simple linear model. Let’s take a look at the diagnostics plots:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">autoplot</span>(model_log, <span class="dt">which =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_minimal</span>()</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-196-1.png" width="672" /></p>
</div>
<div id="using-a-model-for-prediction" class="section level2">
<h2><span class="header-section-number">7.4</span> Using a model for prediction</h2>
<p>Once you estimated a model, you might want to use it for prediction. This is easily done using the <code>predict()</code> function that works with most models. Prediction is also useful as a way to test the accuracy of your model: split your data into a training set (used for estimation) and a testing set (used for the pseudo-prediction) and see if your model overfits the data. We are going to see how to do that in a later section; for now, let’s just get acquainted with <code>predict()</code>.</p>
<p>Let’s go back to the models we estimated in the previous section, <code>model3</code> and <code>model_log</code>. Let’s also take a subsample of data, which we will be using for prediction:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1234</span>)

pred_set =<span class="st"> </span>Housing <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">sample_n</span>(<span class="dv">20</span>)</code></pre></div>
<p>so that we get always the same <code>pred_set</code> I set the random seed first. Let’s take a look at the data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(pred_set)</code></pre></div>
<pre><code>##      price lotsize bedrooms bathrms stories driveway recroom fullbase
## 63   52000    4280        2       1       1      yes      no       no
## 340  62500    3900        3       1       2      yes      no       no
## 332 175000    8960        4       4       4      yes      no       no
## 339 141000    8100        4       1       2      yes     yes      yes
## 467  54000    2856        3       1       3      yes      no       no
## 347  52000    4130        3       2       2      yes      no       no
## 6    66000    4160        3       1       1      yes     yes      yes
## 126  95000    4260        4       2       2      yes      no       no
## 359  97000   12090        4       2       2      yes      no       no
## 277  70000    6300        3       1       1      yes      no       no
## 372  85000    6420        3       1       1      yes      no      yes
## 292  39000    4000        3       1       2      yes      no       no
## 151  59900    3450        3       1       2      yes      no       no
## 493  53000    4050        2       1       1      yes      no       no
## 156  60000    2610        4       3       2       no      no       no
## 445  72500    5720        2       1       2      yes      no       no
## 152  35500    3000        3       1       2       no      no       no
## 142  40000    2650        3       1       2      yes      no      yes
## 99   35000    3500        2       1       1      yes     yes       no
## 123  37000    4400        2       1       1      yes      no       no
##     gashw airco garagepl prefarea
## 63     no   yes        2       no
## 340    no    no        0       no
## 332    no   yes        3       no
## 339    no   yes        2      yes
## 467    no    no        0      yes
## 347    no    no        2       no
## 6      no   yes        0       no
## 126   yes    no        0       no
## 359    no    no        2      yes
## 277    no   yes        2       no
## 372    no   yes        0      yes
## 292    no    no        1       no
## 151    no    no        1       no
## 493    no    no        0       no
## 156    no    no        0       no
## 445    no   yes        0      yes
## 152    no    no        0       no
## 142    no    no        1       no
## 99     no    no        0       no
## 123    no    no        0       no</code></pre>
<p>If we wish to use it for prediction, this is easily done with <code>predict()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">predict</span>(model3, pred_set)</code></pre></div>
<pre><code>##        63       340       332       339       467       347         6 
##  63506.66  49425.47 150689.71 106607.68  61649.59  73066.34  66387.12 
##       126       359       277       372       292       151       493 
##  79701.11 112496.42  72502.20  79260.00  54024.93  52074.46  41568.47 
##       156       445       152       142        99       123 
##  68666.08  76050.14  39546.02  54689.81  44129.28  42809.67</code></pre>
<p>This returns a vector of predicted prices. This can then be used to compute the Root Mean Squared Error for instance. Let’s to it within a tidyverse pipeline:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rmse =<span class="st"> </span>pred_set <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">predictions =</span> <span class="kw">predict</span>(model3, .)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="kw">sqrt</span>(<span class="kw">sum</span>(predictions <span class="op">-</span><span class="st"> </span>price)<span class="op">**</span><span class="dv">2</span><span class="op">/</span><span class="kw">n</span>()))</code></pre></div>
<p>The root mean square error of <code>model3</code> is 1666.1312666.</p>
<p>I also use the <code>n()</code> function which returns the number of observations in a group (or all the observations, if the data is not grouped). Let’s compare <code>model3</code> ’s RMSE with the one from <code>model_log</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rmse2 =<span class="st"> </span>pred_set <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">predictions =</span> <span class="kw">exp</span>(<span class="kw">predict</span>(model_log, .))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="kw">sqrt</span>(<span class="kw">sum</span>(predictions <span class="op">-</span><span class="st"> </span>price)<span class="op">**</span><span class="dv">2</span><span class="op">/</span><span class="kw">n</span>()))</code></pre></div>
<p>Don’t forget to exponentiate the predictions, remember you’re dealing with a log-linear model! <code>model_log</code>’s RMSE is 1359.0392252 which is lower than <code>model3</code>’s. However, keep in mind that the model was estimated on the whole data, and then the prediction quality was assessed using a subsample of the data the model was estimated on… so actually we can’t really say if <code>model_log</code>’s predictions are very useful. In a later section we are going to learn how to do cross validation to avoid this issue.</p>
<p>Also another problem of what I did before, unrelated to statistics per se, is that I wanted to compute the same quantity for two different models, and did so by copy and pasting 3 lines of code. That’s not much, but if I wanted to compare 10 models, copy and paste mistakes could have sneaked in. Instead, it would have been nice to have a function that computes the RMSE and then use it on my models. We are going to learn how to write our own function and use it just like if it was another built-in R function.</p>
</div>
<div id="beyond-linear-regression" class="section level2">
<h2><span class="header-section-number">7.5</span> Beyond linear regression</h2>
<p>R has a lot of other built-in functions for regression, such as <code>glm()</code> (for Generalized Linear Models) and <code>nls()</code> for (for Nonlinear Least Squares). There are also functions and additional packages for time series, panel data, machine learning, bayesian and nonparametric methods. Presenting everything here would take too much space, and would be pretty useless as you can find whatever you need using an internet search engine. What you have learned until now is quite general and should work on many type of models. To help you out, here is a list of methods and the recommended packages that you can use:</p>
<table>
<thead>
<tr class="header">
<th>Model</th>
<th>Package</th>
<th>Quick example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Robust Linear Regression</td>
<td><code>MASS</code></td>
<td><code>rlm(y ~ x, data = mydata)</code></td>
</tr>
<tr class="even">
<td>Nonlinear Least Squares</td>
<td><code>stats</code><a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a></td>
<td><code>nls(y ~ x1 / (1 + x2), data = mydata)</code><a href="#fn5" class="footnoteRef" id="fnref5"><sup>5</sup></a></td>
</tr>
<tr class="odd">
<td>Logit</td>
<td><code>stats</code></td>
<td><code>glm(y ~ x, data = mydata, family = &quot;binomial&quot;)</code></td>
</tr>
<tr class="even">
<td>Probit</td>
<td><code>stats</code></td>
<td><code>glm(y ~ x, data = mydata, family = binomial(link = &quot;probit&quot;))</code></td>
</tr>
<tr class="odd">
<td>K-Means</td>
<td><code>stats</code></td>
<td><code>kmeans(data, n)</code><a href="#fn6" class="footnoteRef" id="fnref6"><sup>6</sup></a></td>
</tr>
<tr class="even">
<td>PCA</td>
<td><code>stats</code></td>
<td><code>prcomp(data, scale = TRUE, center = TRUE)</code><a href="#fn7" class="footnoteRef" id="fnref7"><sup>7</sup></a></td>
</tr>
<tr class="odd">
<td>Multinomial Logit</td>
<td><code>mlogit</code></td>
<td>Requires several steps of data pre-processing and formula definition, refer to the <a href="https://cran.r-project.org/web/packages/mlogit/vignettes/mlogit.pdf">Vignette</a> for more details.</td>
</tr>
<tr class="even">
<td>Cox PH</td>
<td><code>survival</code></td>
<td><code>coxph(Surv(y_time, y_status) ~ x, data = mydata)</code><a href="#fn8" class="footnoteRef" id="fnref8"><sup>8</sup></a></td>
</tr>
<tr class="odd">
<td>Time series</td>
<td>Several, depending on your needs.</td>
<td>Time series in R is a vast subject that would require a very thick book to cover. You can get started with the following series of blog articles, <a href="http://www.business-science.io/timeseries-analysis/2017/07/02/tidy-timeseries-analysis.html">Tidy time-series, part 1</a>, <a href="http://www.business-science.io/timeseries-analysis/2017/07/23/tidy-timeseries-analysis-pt-2.html">Tidy time-series, part 2</a>, <a href="http://www.business-science.io/timeseries-analysis/2017/07/30/tidy-timeseries-analysis-pt-3.html">Tidy time-series, part 3</a> and <a href="http://www.business-science.io/timeseries-analysis/2017/08/30/tidy-timeseries-analysis-pt-4.html">Tidy time-series, part 3</a></td>
</tr>
<tr class="even">
<td>Panel data</td>
<td><code>plm</code></td>
<td><code>plm(y ~ x, data = mydata, model = &quot;within|random&quot;)</code></td>
</tr>
<tr class="odd">
<td>Neural Networks</td>
<td>Several, depending on your needs.</td>
<td>R is a very popular programming language for machine learning. <a href="http://ww.rblog.uni-freiburg.de/2017/02/07/deep-learning-in-r">This blog post</a> lists and compares some of the most useful packages for Neural nets and deep learning.</td>
</tr>
<tr class="even">
<td>Nonparametric regression</td>
<td><code>np</code></td>
<td>Several functions and options available, refer to the <a href="https://cran.r-project.org/web/packages/np/vignettes/np.pdf">Vignette</a> for more details.</td>
</tr>
</tbody>
</table>
<p>I put neural networks in the table, but you can also find packages for regression trees, naive bayes, and pretty much any machine learning method out there! The same goes for Bayesian methods. Popular packages include <code>rstan</code>, <code>rjags</code> which link R to STAN and JAGS (two other pieces of software that do the Gibbs sampling for you) which are tools that allow you to fit very general models. It is also possible to estimate models using Bayesian inference without the need of external tools, with the <code>bayesm</code> package which estimates the usual micro-econometric models. There really are a lot of packages available for Bayesian inference, and you can find them all in the <a href="https://cran.r-project.org/web/views/Bayesian.html">related CRAN Task View</a>.</p>
</div>
<div id="advanced-topics" class="section level2">
<h2><span class="header-section-number">7.6</span> Advanced topics</h2>
<div id="bootstrapping" class="section level3">
<h3><span class="header-section-number">7.6.1</span> Bootstrapping</h3>
<p>The <code>broom</code> package includes a <code>bootstrap()</code> function that allows you to resample your data with replacement and estimate your model on each sample. A worked example is available in one of the package’s <a href="https://cran.r-project.org/web/packages/broom/vignettes/bootstrapping.html">Vignette</a>. R also includes a more general <code>boot()</code> function, but we are going to learn about this one later, as it involves some programming. Let’s go back to <code>model_log</code>, and try to get bootstrapped confidence intervals (as shown in the Vignette I linked above):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boot_result =<span class="st"> </span>Housing <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">bootstrap</span>(<span class="dv">50</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">do</span>(<span class="kw">tidy</span>(<span class="kw">lm</span>(<span class="kw">log</span>(price) <span class="op">~</span><span class="st"> </span>bedrooms <span class="op">+</span><span class="st"> </span>driveway, <span class="dt">data =</span> .)))</code></pre></div>
<p>I just use 2 variables to make the output smaller. Let’s take a look at <code>boot_result</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(boot_result)</code></pre></div>
<pre><code>## # A tibble: 150 x 6
## # Groups:   replicate [50]
##    replicate        term   estimate  std.error  statistic      p.value
##        &lt;int&gt;       &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt;
##  1         1 (Intercept) 10.2691480 0.06612497 155.299091 0.000000e+00
##  2         1    bedrooms  0.1653885 0.01834047   9.017679 3.289600e-18
##  3         1 drivewayyes  0.3422638 0.03879711   8.821890 1.537261e-17
##  4         2 (Intercept) 10.1079413 0.06624453 152.585303 0.000000e+00
##  5         2    bedrooms  0.2325295 0.01853996  12.542069 7.224885e-32
##  6         2 drivewayyes  0.3196658 0.03952153   8.088397 3.969076e-15
##  7         3 (Intercept) 10.1945652 0.06741861 151.212929 0.000000e+00
##  8         3    bedrooms  0.1996018 0.01955275  10.208379 1.682842e-22
##  9         3 drivewayyes  0.3056554 0.03868654   7.900821 1.549478e-14
## 10         4 (Intercept) 10.2896575 0.06921918 148.653275 0.000000e+00
## # ... with 140 more rows</code></pre>
<p><code>boot_result</code> is a <code>tibble</code> grouped by the new variable <code>replicate</code>. Now it is easy to compute confidence intervals for the parameters:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boot_result <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(term) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">low =</span> <span class="kw">quantile</span>(estimate, .<span class="dv">05</span><span class="op">/</span><span class="dv">2</span>),
            <span class="dt">high =</span> <span class="kw">quantile</span>(estimate, <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>.<span class="dv">05</span><span class="op">/</span><span class="dv">2</span>))</code></pre></div>
<pre><code>## # A tibble: 3 x 3
##          term        low       high
##         &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt;
## 1    bedrooms  0.1471192  0.2252752
## 2 drivewayyes  0.3060920  0.4194924
## 3 (Intercept) 10.0622613 10.3195883</code></pre>
<p><code>quantile()</code> is a built-in function that returns the quantile at the <span class="math inline">\(alpha\)</span> level for a given vector (in this case the vector of estimates). Of course, we had to group by <code>term</code> first, as we need to compute the confidence intervals, for each terms (or estimated parameters) separately. Plotting the densities of the bootstrapped parameters might also prove interesting:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(boot_result, <span class="kw">aes</span>(estimate)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>term, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</code></pre></div>
<p><img src="modern_r_for_statec_files/figure-html/unnamed-chunk-206-1.png" width="672" /></p>
</div>
<div id="cross-validation" class="section level3">
<h3><span class="header-section-number">7.6.2</span> Cross-validation</h3>
<p>To do cross-validation, we are going to use the <code>modelr</code> package, which is also part of the <code>tidyverse</code>.<a href="#fn9" class="footnoteRef" id="fnref9"><sup>9</sup></a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(modelr)</code></pre></div>
<p><code>modelr</code> includes two functions for cross-validation, <code>crossv_kfold</code> and <code>crossv_mc</code>, which do K-fold Cross-Validation and Monte Carlo Cross-Validation respectively. First, let’s see what <code>cross_mc()</code> (<code>cross_kfold()</code>) returns when applied to data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Housing <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">crossv_mc</span>(<span class="dt">n =</span> <span class="dv">50</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">print</span>()</code></pre></div>
<pre><code>## # A tibble: 50 x 3
##             train           test   .id
##            &lt;list&gt;         &lt;list&gt; &lt;chr&gt;
##  1 &lt;S3: resample&gt; &lt;S3: resample&gt;    01
##  2 &lt;S3: resample&gt; &lt;S3: resample&gt;    02
##  3 &lt;S3: resample&gt; &lt;S3: resample&gt;    03
##  4 &lt;S3: resample&gt; &lt;S3: resample&gt;    04
##  5 &lt;S3: resample&gt; &lt;S3: resample&gt;    05
##  6 &lt;S3: resample&gt; &lt;S3: resample&gt;    06
##  7 &lt;S3: resample&gt; &lt;S3: resample&gt;    07
##  8 &lt;S3: resample&gt; &lt;S3: resample&gt;    08
##  9 &lt;S3: resample&gt; &lt;S3: resample&gt;    09
## 10 &lt;S3: resample&gt; &lt;S3: resample&gt;    10
## # ... with 40 more rows</code></pre>
<p>This is a <code>tibble</code> with 3 colmuns, two of them being list-columns; <code>train</code> and <code>test</code>. Each element of <code>train</code> and <code>test</code> is a resampled <code>tibble</code> of the original data. This means that we can now estimate the our first model (the simple linear one) on each resampled data using <code>map()</code>:</p>
<p>Now if we want to estimate all these models:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cv_models =<span class="st"> </span>Housing <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">crossv_mc</span>(<span class="dt">n =</span> <span class="dv">50</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="kw">map</span>(train, <span class="op">~</span><span class="kw">lm</span>(price <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> .)))

<span class="kw">print</span>(cv_models)</code></pre></div>
<pre><code>## # A tibble: 50 x 4
##             train           test   .id    model
##            &lt;list&gt;         &lt;list&gt; &lt;chr&gt;   &lt;list&gt;
##  1 &lt;S3: resample&gt; &lt;S3: resample&gt;    01 &lt;S3: lm&gt;
##  2 &lt;S3: resample&gt; &lt;S3: resample&gt;    02 &lt;S3: lm&gt;
##  3 &lt;S3: resample&gt; &lt;S3: resample&gt;    03 &lt;S3: lm&gt;
##  4 &lt;S3: resample&gt; &lt;S3: resample&gt;    04 &lt;S3: lm&gt;
##  5 &lt;S3: resample&gt; &lt;S3: resample&gt;    05 &lt;S3: lm&gt;
##  6 &lt;S3: resample&gt; &lt;S3: resample&gt;    06 &lt;S3: lm&gt;
##  7 &lt;S3: resample&gt; &lt;S3: resample&gt;    07 &lt;S3: lm&gt;
##  8 &lt;S3: resample&gt; &lt;S3: resample&gt;    08 &lt;S3: lm&gt;
##  9 &lt;S3: resample&gt; &lt;S3: resample&gt;    09 &lt;S3: lm&gt;
## 10 &lt;S3: resample&gt; &lt;S3: resample&gt;    10 &lt;S3: lm&gt;
## # ... with 40 more rows</code></pre>
<p>We added a list-column with the 50 models estimated (or trained) on the train data. Now we can compute, say, the RMSE from before on each one. <code>modelr</code> includes a <code>rmse()</code> function, so unlike in the previous section where we computed the RMSE manually we are simply going to use this function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rmse_boot =<span class="st"> </span>cv_models <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rmse_all_models =</span> <span class="kw">map2_dbl</span>(model, test, <span class="op">~</span><span class="kw">rmse</span>(.x, .y))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">pull</span>(rmse_all_models)

<span class="kw">print</span>(rmse_boot)</code></pre></div>
<pre><code>##  [1] 19331.78 13595.67 14595.43 18381.15 15827.10 13778.53 14573.62
##  [8] 13295.68 15928.93 15541.70 17061.77 15001.47 13137.02 15160.48
## [15] 14912.78 15000.28 16917.83 14112.38 17061.24 15506.28 13873.93
## [22] 15587.48 15010.92 15164.69 15528.94 16690.14 14598.18 17585.55
## [29] 16538.00 17285.54 17426.84 15669.20 14773.61 17770.10 15105.68
## [36] 14727.60 14460.48 16959.04 17045.19 19100.78 14464.48 15733.42
## [43] 14962.71 15147.54 18678.01 11970.67 15005.83 13300.56 13794.24
## [50] 14082.58</code></pre>
<p>We can now compute the mean of this <code>rmse_boot</code> variable:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">booted_rmse_lin_lin =<span class="st"> </span><span class="kw">mean</span>(rmse_boot)</code></pre></div>
<p>which is equal to 1.553526110^{4}. Let’s do the same calculation for the log-lin model, and let’s do it in one single pipe workflow:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">booted_rmse_log_lin =<span class="st"> </span>Housing <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">crossv_mc</span>(<span class="dt">n =</span> <span class="dv">50</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="kw">map</span>(train, <span class="op">~</span><span class="kw">lm</span>(<span class="kw">log</span>(price) <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> .))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rmse_all_models =</span> <span class="kw">map2_dbl</span>(model, test, <span class="op">~</span><span class="kw">rmse</span>(.x, .y))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">pull</span>(rmse_all_models) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mean</span>()</code></pre></div>
<p><code>booted_rmse_log_lin</code> is equal to 0.2161446, which is much lower than in the lin-lin model.</p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="4">
<li id="fn4"><p>This package gets installed with R, no need to add it<a href="statistical-models.html#fnref4">↩</a></p></li>
<li id="fn5"><p>The formula in the example is shown for illustration purposes.<a href="statistical-models.html#fnref5">↩</a></p></li>
<li id="fn6"><p><code>data</code> must only contain numeric values, and <code>n</code> is the number of clusters.<a href="statistical-models.html#fnref6">↩</a></p></li>
<li id="fn7"><p><code>data</code> must only contain numeric values, or a formula can be provided.<a href="statistical-models.html#fnref7">↩</a></p></li>
<li id="fn8"><p><code>Surv(y_time, y_status)</code> creates a <em>survival</em> object, where <code>y_time</code> is the time to event <code>y_status</code>. It is possible to create more complex survival objects depending on exactly which data you are dealing with.<a href="statistical-models.html#fnref8">↩</a></p></li>
<li id="fn9"><p>This package is still somewhat young and experimental and might get replaced by two others in the future. At some point in the future you might get a warning message telling you that the package is deprecated. When this happens, you would need to switch to the new packages, but transition should be fairly easy.<a href="statistical-models.html#fnref9">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="graphs.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="advanced-topics-1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
